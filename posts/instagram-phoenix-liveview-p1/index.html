<!DOCTYPE html>

<html lang="zh-CN">

<head>
    
    <title>使用 Phoenix LiveView 构建 Instagram (1) - 和光同尘|MarkHoo_不积跬步无以至千里，不积小流无以成江海</title>
    <meta charset="UTF-8">
    <meta name="description" content="终日而思,不如须臾之所学也">
    <meta name="keywords" content="和光同尘,MarkHoo,Python,Elixir,Phoenix,SpringBoot,Django,">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="https://media.markhoo.com/image/favicon24.ico" type="image/x-icon" />
    <meta name="description" content="使用PETAL(Phoenix、Elixir、TailwindCSS、AlpineJS、LiveView)技术栈构建一个简化版的Instagram Web应用程序">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Phoenix LiveView 构建 Instagram (1)">
<meta property="og:url" content="https://blog.markhoo.com/posts/instagram-phoenix-liveview-p1/">
<meta property="og:site_name" content="和光同尘|MarkHoo_不积跬步无以至千里，不积小流无以成江海">
<meta property="og:description" content="使用PETAL(Phoenix、Elixir、TailwindCSS、AlpineJS、LiveView)技术栈构建一个简化版的Instagram Web应用程序">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/08/30/ahLEBfk4qVuvDHS.gif">
<meta property="og:image" content="https://s2.loli.net/2023/08/30/VAJIaFk1Krbm3fN.png">
<meta property="og:image" content="https://s2.loli.net/2023/08/30/7H3adh9Zj6XNzkb.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/08/30/9fBiej2YJF7soHR.jpg">
<meta property="article:published_time" content="2023-08-29T14:43:40.000Z">
<meta property="article:modified_time" content="2023-08-30T08:54:21.458Z">
<meta property="article:author" content="MarkHoo">
<meta property="article:tag" content="Elixir">
<meta property="article:tag" content="Phoenix">
<meta property="article:tag" content="LiveView">
<meta property="article:tag" content="TailwindCSS">
<meta property="article:tag" content="AlpineJS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/08/30/ahLEBfk4qVuvDHS.gif">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1693393436683">
     
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1693393436683">
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://s2.loli.net/2023/08/30/SfpNaZsg3IW5MDz.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="MarkHoo" class="mdui-btn mdui-btn-icon"><img src="https://media.markhoo.com/avatar.jpg" alt="MarkHoo"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="MarkHoo">
            <img src="https://media.markhoo.com/avatar.jpg" alt="MarkHoo" alt="MarkHoo">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>53</div>
        <div><span>标签</span>40</div>
        <div><span>分类</span>11</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archives" title="归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/books" title="书架">
            <i class="mdui-list-item-icon nexmoefont icon-battlenet"></i>
            <div class="mdui-list-item-content">
                书架
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about" title="关于">
            <i class="mdui-list-item-icon nexmoefont icon-coffee"></i>
            <div class="mdui-list-item-content">
                关于
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/links" title="邻居">
            <i class="mdui-list-item-icon nexmoefont icon-dribbble"></i>
            <div class="mdui-list-item-content">
                邻居
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="搜索" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/182687081" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/markhoo/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/AlpineJS/" style="font-size: 16.25px;">AlpineJS</a> <a href="/tags/ArchLinux/" style="font-size: 10px;">ArchLinux</a> <a href="/tags/C-C/" style="font-size: 10px;">C/C++</a> <a href="/tags/CentOS7/" style="font-size: 15px;">CentOS7</a> <a href="/tags/Django/" style="font-size: 18.75px;">Django</a> <a href="/tags/Elixir/" style="font-size: 18.75px;">Elixir</a> <a href="/tags/EndeavourOS/" style="font-size: 10px;">EndeavourOS</a> <a href="/tags/Erlang/" style="font-size: 10px;">Erlang</a> <a href="/tags/Gin/" style="font-size: 10px;">Gin</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Gitlab/" style="font-size: 10px;">Gitlab</a> <a href="/tags/Go/" style="font-size: 16.25px;">Go</a> <a href="/tags/Gunicorn/" style="font-size: 12.5px;">Gunicorn</a> <a href="/tags/Hugo/" style="font-size: 10px;">Hugo</a> <a href="/tags/IDE/" style="font-size: 11.25px;">IDE</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Linux/" style="font-size: 13.75px;">Linux</a> <a href="/tags/LiveView/" style="font-size: 16.25px;">LiveView</a> <a href="/tags/Lua/" style="font-size: 11.25px;">Lua</a> <a href="/tags/Manim/" style="font-size: 10px;">Manim</a> <a href="/tags/NeoVim/" style="font-size: 11.25px;">NeoVim</a> <a href="/tags/Nginx/" style="font-size: 13.75px;">Nginx</a> <a href="/tags/Phoenix/" style="font-size: 17.5px;">Phoenix</a> <a href="/tags/PyCharm/" style="font-size: 10px;">PyCharm</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/Rest/" style="font-size: 10px;">Rest</a> <a href="/tags/TailwindCSS/" style="font-size: 16.25px;">TailwindCSS</a> <a href="/tags/Unix/" style="font-size: 10px;">Unix</a> <a href="/tags/Vim/" style="font-size: 12.5px;">Vim</a> <a href="/tags/hexo/" style="font-size: 11.25px;">hexo</a> <a href="/tags/pip/" style="font-size: 11.25px;">pip</a> <a href="/tags/pypi/" style="font-size: 10px;">pypi</a> <a href="/tags/xadmin/" style="font-size: 10px;">xadmin</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/" style="font-size: 10px;">网易云音乐</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 11.25px;">面试题</a> <a href="/tags/%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/" style="font-size: 10px;">音乐播放器</a>
    </div>
    
  </div>

    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 MarkHoo
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><a target="_blank" href="https://beian.miit.gov.cn">苏ICP备17044309号</a><br><a target="_blank" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"><img src="https://i.dawnlab.me/c0268c1e6cfd0863d6ba35be1575941a.png" width="150px"></a><script data-ad-client="ca-pub-2058306854838448" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: 45.83333333333333%;"> 
              <img data-src="https://s2.loli.net/2023/08/30/SfpNaZsg3IW5MDz.jpg" data-sizes="auto" alt="使用 Phoenix LiveView 构建 Instagram (1)" class="lazyload">
              <h1>使用 Phoenix LiveView 构建 Instagram (1)</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2023年08月29日</a>
    <a><i class="nexmoefont icon-areachart"></i>8.6k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 47 分钟</a>
</div>

      

      <blockquote>
<p>使用PETAL(Phoenix、Elixir、TailwindCSS、AlpineJS、LiveView)技术栈构建一个简化版的Instagram Web应用程序</p>
</blockquote>
<span id="more"></span>

<p>更好的学习方法是亲自动手构建东西，让我们使用很棒的 PETAL（Phoenix、Elixir、TailwindCSS、AlpineJS、LiveView）堆栈构建一个简化版的 Instagram Web 应用程序，并深入了解函数式的黑暗世界编程和最热门的孩子在凤凰框架与LiveView。</p>
<p>我不认为自己是一名老师，也不是任何方面的专家，我只是一个像你一样的普通人。任何人都可以遵循，即使您可能会被整个堆栈吓倒，这是一种新技术，不是很流行，而且没有很多资源和材料。如果您是一位经验丰富的开发人员，那么您不会有任何问题，这并不意味着如果您是初学者，您就无法跟上，我会尽力使其对初学者友好，但我不会详细介绍堆栈的每个基础知识或网络开发，所以你已经被警告了。</p>
<p>Elixir 是我有幸学习和尝试的最好的语言之一，我想与世界分享我的热情，我希望其他人能感受到我对这门语言的感受。</p>
<p>免责声明： Elixir、函数式编程、Phoenix 框架，可能听起来、看起来很困难和复杂，但它根本不是，比其他任何东西都容易，它可能不适合每个人，因为我们的想法并不相同，但对于那些认为就像我尝试的感觉一样。TailwindCSS 可能有些固执己见，看起来不值得尝试，我知道，因为我也是这么感觉的，但只要尝试一下，你用得越多，它就会变得越有意义，你就会越喜欢它，它让 CSS 变得不复杂，让你不放弃前端开发，CSS仍然会很痛苦，作为开发者，我们没有耐心把UI弄好，但它是一股新鲜空气。</p>
<p>我们不会在本文中完成整个项目，这将是一系列文章，因此这将是第 1 部分。我假设您有自己的开发环境，安装了 Elixir，我的开发环境是在带有 WSL 的 Windows 10 上。我们将尽力尽可能详细，但保持简单，这仅用于学习目的，因此它不会是精确的副本，也不会具有所有功能，我们将尽可能接近真实的东西，也我们不会专注于使网站具有响应能力，我们只会使其适用于大屏幕。</p>
<p>让我们首先转到终端并使用 LiveView 创建一个新的 Phoenix 应用程序。</p>
<p><code>$ mix phx.new instagram_clone --live</code></p>
<p>安装并获取所有依赖项后。</p>
<p><code>$ cd instagram_clone &amp;&amp; mix ecto.create</code></p>
<p>我创建了一个 GitHub 存储库，您可以在此处访问Instagram 克隆 GitHub 存储库，您可以随意使用代码，欢迎贡献。</p>
<p>让我们运行服务器以确保一切正常。</p>
<p><code>$ iex -S mix phx.server</code></p>
<p>如果没有错误，当您访问 <a target="_blank" rel="noopener" href="http://localhost:4000/">http://localhost:4000/</a> 时，您应该会看到默认的 Phoenix 框架主页</p>
<p>我使用 Visual Studio Code，因此我将使用以下命令打开项目文件夹。</p>
<p><code>$ code .</code></p>
<p>现在让我们在 mix.exs 文件中添加混合依赖项。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-comment"># mix.exs file</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">deps</span></span> <span class="hljs-keyword">do</span><br>    [<br>      &#123;<span class="hljs-symbol">:phoenix</span>, <span class="hljs-string">&quot;~&gt; 1.5.6&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:phoenix_ecto</span>, <span class="hljs-string">&quot;~&gt; 4.1&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:ecto_sql</span>, <span class="hljs-string">&quot;~&gt; 3.4&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:postgrex</span>, <span class="hljs-string">&quot;&gt;= 0.0.0&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:floki</span>, <span class="hljs-string">&quot;&gt;= 0.27.0&quot;</span>, <span class="hljs-symbol">only:</span> <span class="hljs-symbol">:test</span>&#125;,<br>      &#123;<span class="hljs-symbol">:phoenix_html</span>, <span class="hljs-string">&quot;~&gt; 2.11&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:phoenix_live_reload</span>, <span class="hljs-string">&quot;~&gt; 1.2&quot;</span>, <span class="hljs-symbol">only:</span> <span class="hljs-symbol">:dev</span>&#125;,<br>      &#123;<span class="hljs-symbol">:phoenix_live_dashboard</span>, <span class="hljs-string">&quot;~&gt; 0.3 or ~&gt; 0.2.9&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:telemetry_metrics</span>, <span class="hljs-string">&quot;~&gt; 0.4&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:telemetry_poller</span>, <span class="hljs-string">&quot;~&gt; 0.4&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:gettext</span>, <span class="hljs-string">&quot;~&gt; 0.11&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:jason</span>, <span class="hljs-string">&quot;~&gt; 1.0&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:plug_cowboy</span>, <span class="hljs-string">&quot;~&gt; 2.0&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:phoenix_live_view</span>, <span class="hljs-string">&quot;~&gt; 0.15.4&quot;</span>, <span class="hljs-symbol">override:</span> <span class="hljs-keyword">true</span>&#125;,<br>      &#123;<span class="hljs-symbol">:timex</span>, <span class="hljs-string">&quot;~&gt; 3.6&quot;</span>&#125;,<br>      &#123;<span class="hljs-symbol">:faker</span>, <span class="hljs-string">&quot;~&gt; 0.16.0&quot;</span>&#125;<br>    ]<br>  <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>我们将 :phoenix_live_view 更新到 15.4 版本，并添加了 timex 来处理时间，并在需要测试数据时添加 faker。</p>
<h2 id="设置-TailwindCSS-和-AlpineJS"><a href="#设置-TailwindCSS-和-AlpineJS" class="headerlink" title="设置 TailwindCSS 和 AlpineJS"></a>设置 TailwindCSS 和 AlpineJS</h2><p>确保拥有最新的 Node 和 npm 版本。</p>
<p><code>$ cd assets</code></p>
<p><code>$ npm i tailwindcss postcss autoprefixer postcss-loader@4.2 --save-dev</code></p>
<p>接下来让我们配置 Webpack、PostCSS 和 TailwindCSS。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elixir">/<span class="hljs-regexp">/ /assets</span><span class="hljs-regexp">/webpack.config.js</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">use: [</span><br><span class="hljs-regexp">  MiniCssExtractPlugin.loader,</span><br><span class="hljs-regexp">  &#x27;css-loader&#x27;,</span><br><span class="hljs-regexp">  &#x27;sass-loader&#x27;,</span><br><span class="hljs-regexp">  &#x27;postcss-loader&#x27;, /</span><span class="hljs-regexp">/ Add this</span><br><span class="hljs-regexp">],</span><br></code></pre></td></tr></table></figure>

<p>添加包含<code>/assets/postcss.config.js</code>以下内容的文件：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elixir">/<span class="hljs-regexp">/ /assets</span><span class="hljs-regexp">/postcss.config.js</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">module.exports = &#123;</span><br><span class="hljs-regexp">    plugins: &#123;</span><br><span class="hljs-regexp">        &quot;postcss-import&quot;: &#123;&#125;,</span><br><span class="hljs-regexp">        tailwindcss: &#123;&#125;,</span><br><span class="hljs-regexp">        autoprefixer: &#123;&#125;</span><br><span class="hljs-regexp">    &#125;</span><br><span class="hljs-regexp">&#125;</span><br></code></pre></td></tr></table></figure>

<p>创建 TailwindCSS 配置文件。</p>
<p><code>$ npx tailwindcss init</code></p>
<p>将以下配置添加到该文件中：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs elixir">const colors = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;tailwindcss/colors&#x27;</span>)<br><br>module.exports = &#123;<br>  <span class="hljs-symbol">purge:</span> &#123;<br>    <span class="hljs-symbol">enabled:</span> process.env.NODE_ENV === <span class="hljs-string">&quot;production&quot;</span>,<br>    <span class="hljs-symbol">content:</span> [<br>      <span class="hljs-string">&quot;../lib/**/*.eex&quot;</span>,<br>      <span class="hljs-string">&quot;../lib/**/*.leex&quot;</span>,<br>      <span class="hljs-string">&quot;../lib/**/*_view.ex&quot;</span><br>    ],<br>    <span class="hljs-symbol">options:</span> &#123;<br>      <span class="hljs-symbol">whitelist:</span> [<span class="hljs-regexp">/phx/</span>, <span class="hljs-regexp">/nprogress/</span>]<br>    &#125;<br>  &#125;,<br>  <span class="hljs-symbol">theme:</span> &#123;<br>    <span class="hljs-symbol">extend:</span> &#123;<br>      <span class="hljs-symbol">colors:</span> &#123;<br>        <span class="hljs-string">&#x27;light-blue&#x27;</span>: colors.lightBlue,<br>        <span class="hljs-symbol">cyan:</span> colors.cyan,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-symbol">variants:</span> &#123;<br>    <span class="hljs-symbol">extend:</span> &#123;<br>      <span class="hljs-symbol">borderWidth:</span> [<span class="hljs-string">&#x27;hover&#x27;</span>],<br>    &#125;<br>  &#125;,<br>  <span class="hljs-symbol">plugins:</span> [<span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;@tailwindcss/forms&#x27;</span>)],<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们配置要清除的文件，添加自定义颜色和自定义表单插件。现在让我们将自定义表单添加到 npm 依赖项中。</p>
<p><code>$ npm i @tailwindcss/forms --save-dev</code></p>
<p>对于自定义组件冲突，让我们添加 postcss-import 插件。</p>
<p><code>$ npm i postcss-import --save-dev</code></p>
<p>转到<code>/assets/css/app.scss</code>文件顶部并添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">/* This file is <span class="hljs-keyword">for</span> your main application css. *<span class="hljs-regexp">/</span><br><span class="hljs-regexp">@import &quot;tailwindcss/base</span><span class="hljs-string">&quot;;</span><br><span class="hljs-string">@import &quot;</span>tailwindcss/components<span class="hljs-string">&quot;;</span><br><span class="hljs-string">@import &quot;</span>tailwindcss/utilities<span class="hljs-string">&quot;;</span><br></code></pre></td></tr></table></figure>

<p>删掉<code>/assets/css/phoenix.css</code>我们就不需要了</p>
<p>让我们退出资产文件夹<code>$ cd ..</code>并运行我们的服务器<code>$ iex -S mix phx.server</code></p>
<p>通过<code>/lib/instagram_clone_web/live/page_live.html.leex</code>删除所有内容并添加以下内容来测试它：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;h1 class=<span class="hljs-string">&quot;text-red-500 text-5xl font-bold text-center&quot;</span>&gt;Instagram Clone&lt;<span class="hljs-regexp">/h1&gt;</span><br></code></pre></td></tr></table></figure>

<p>我们的主页上应该有一个红色的大标题。</p>
<p>删除<code>/lib/instagram_clone_web/live/page_live.ex</code>所有内容，因为我们的主页中不需要任何内容，然后添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramCloneWeb.PageLive</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> InstagramCloneWeb, <span class="hljs-symbol">:live_view</span><br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mount</span></span>(_params, _session, socket) <span class="hljs-keyword">do</span><br>    &#123;<span class="hljs-symbol">:ok</span>, socket&#125;<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>去<code>/lib/instagram_clone_web/templates/layout/root.html.leex</code>删除默认的phoenix标头，该文件上应该有以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>  &lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> content=<span class="hljs-string">&quot;IE=edge&quot;</span>/&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>/&gt;<br>    &lt;%= csrf_meta_tag() %&gt;<br>    &lt;%= live_title_tag assigns[<span class="hljs-symbol">:page_title</span>] || <span class="hljs-string">&quot;InstagramClone&quot;</span>, <span class="hljs-symbol">suffix:</span> <span class="hljs-string">&quot; · Phoenix Framework&quot;</span> %&gt;<br>    &lt;link phx-track-static rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;&lt;%= Routes.static_path(@conn, &quot;</span>/css/app.css<span class="hljs-string">&quot;) %&gt;&quot;</span>/&gt;<br>    &lt;script defer phx-track-static type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;&lt;%= Routes.static_path(@conn, &quot;</span>/js/app.js<span class="hljs-string">&quot;) %&gt;&quot;</span>&gt;&lt;<span class="hljs-regexp">/script&gt;</span><br><span class="hljs-regexp">  &lt;/head</span>&gt;<br>  &lt;body&gt;<br>    &lt;!-- Remove Everything Above Here --&gt;<br>    &lt;%= <span class="hljs-variable">@inner_content</span> %&gt;<br>  &lt;<span class="hljs-regexp">/body&gt;</span><br><span class="hljs-regexp">&lt;/html</span>&gt;<br></code></pre></td></tr></table></figure>

<p>现在让我们用 tailwind 自定义我们的主容器，转到<code>/lib/instagram_clone_web/templates/layout/live.html.leex</code>主标签并将以下类添加到主标签中：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;main role=<span class="hljs-string">&quot;main&quot;</span> class=<span class="hljs-string">&quot;container mx-auto max-w-full md:w-11/12 2xl:w-6/12 pt-24&quot;</span>&gt; &lt;!-- This the class that we added --&gt;<br>  &lt;p class=<span class="hljs-string">&quot;alert alert-info&quot;</span> role=<span class="hljs-string">&quot;alert&quot;</span><br>    phx-click=<span class="hljs-string">&quot;lv:clear-flash&quot;</span><br>    phx-value-key=<span class="hljs-string">&quot;info&quot;</span>&gt;&lt;%= live_flash(<span class="hljs-variable">@flash</span>, <span class="hljs-symbol">:info</span>) %&gt;&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">  &lt;p class=&quot;alert alert-danger&quot; role=&quot;alert&quot;</span><br><span class="hljs-regexp">    phx-click=&quot;lv:clear-flash&quot;</span><br><span class="hljs-regexp">    phx-value-key=&quot;error&quot;&gt;&lt;%= live_flash(@flash, :error) %&gt;&lt;/p</span>&gt;<br><br>  &lt;%= <span class="hljs-variable">@inner_content</span> %&gt;<br>&lt;<span class="hljs-regexp">/main&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="添加-AlpineJS"><a href="#添加-AlpineJS" class="headerlink" title="添加 AlpineJS"></a>添加 AlpineJS</h2><p>TailwindCSS 准备就绪后，让我们添加 AlpineJS。让我们再次进入我们的<code>$ cd assets</code>文件夹并运行以下命令：</p>
<p><code>$ npm i alpinejs@2.8.2</code></p>
<p>打开找到的app.js文件<code>/assets/js/app.js</code>并添加以下内容，这样我们就不会与LiveView自己的DOM修补发生任何冲突：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-keyword">import</span> Alpine from <span class="hljs-string">&quot;alpinejs&quot;</span><br><br>let csrfToken = document.querySelector(<span class="hljs-string">&quot;meta[name=&#x27;csrf-token&#x27;]&quot;</span>).getAttribute(<span class="hljs-string">&quot;content&quot;</span>)<br>let liveSocket = new LiveSocket(<span class="hljs-string">&quot;/live&quot;</span>, Socket, &#123;<br>  <span class="hljs-symbol">params:</span> &#123; <span class="hljs-symbol">_csrf_token:</span> csrfToken &#125;,<br>  <span class="hljs-symbol">dom:</span> &#123;<br>    onBeforeElUpdated(from, to) &#123;<br>      if (from.__x) &#123; Alpine.clone(from.__x, to) &#125;<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>让我们退出资产文件夹<code>$ cd ..</code>并运行我们的服务器<code>$ iex -S mix phx.server</code></p>
<p>测试一下购买并将<code>/lib/instagram_clone_web/live/page_live.html.leex</code>以下内容添加到我们的文件顶部：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;div x-data=<span class="hljs-string">&quot;&#123; open: false &#125;&quot;</span>&gt;<br>    &lt;button <span class="hljs-variable">@click</span>=<span class="hljs-string">&quot;open = true&quot;</span>&gt;Open Dropdown&lt;<span class="hljs-regexp">/button&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;ul</span><br><span class="hljs-regexp">        x-show=&quot;open&quot;</span><br><span class="hljs-regexp">        @click.away=&quot;open = false&quot;</span><br><span class="hljs-regexp">    &gt;</span><br><span class="hljs-regexp">        Dropdown Body</span><br><span class="hljs-regexp">    &lt;/ul</span>&gt;<br>&lt;<span class="hljs-regexp">/div&gt;</span><br></code></pre></td></tr></table></figure>

<p>如果我们进入主页，我们应该有一个可点击的下拉菜单，如下例所示：</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://s2.loli.net/2023/08/30/ahLEBfk4qVuvDHS.gif" alt="instagram-phoenix-p1-1.gif" class="lazyload"></p>
<h2 id="Phx-Gen-Auth"><a href="#Phx-Gen-Auth" class="headerlink" title="Phx.Gen.Auth"></a>Phx.Gen.Auth</h2><p>完成这些设置后，真正的乐趣就开始了。让我们使用 phx.gen.auth 包添加用户身份验证。</p>
<p>让我们将包添加到我们的<code>mix.exs</code>文件中。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">deps</span></span> <span class="hljs-keyword">do</span><br>   [<br>     &#123;<span class="hljs-symbol">:phoenix</span>, <span class="hljs-string">&quot;~&gt; 1.5.6&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:phoenix_ecto</span>, <span class="hljs-string">&quot;~&gt; 4.1&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:ecto_sql</span>, <span class="hljs-string">&quot;~&gt; 3.4&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:postgrex</span>, <span class="hljs-string">&quot;&gt;= 0.0.0&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:floki</span>, <span class="hljs-string">&quot;&gt;= 0.27.0&quot;</span>, <span class="hljs-symbol">only:</span> <span class="hljs-symbol">:test</span>&#125;,<br>     &#123;<span class="hljs-symbol">:phoenix_html</span>, <span class="hljs-string">&quot;~&gt; 2.11&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:phoenix_live_reload</span>, <span class="hljs-string">&quot;~&gt; 1.2&quot;</span>, <span class="hljs-symbol">only:</span> <span class="hljs-symbol">:dev</span>&#125;,<br>     &#123;<span class="hljs-symbol">:phoenix_live_dashboard</span>, <span class="hljs-string">&quot;~&gt; 0.3 or ~&gt; 0.2.9&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:telemetry_metrics</span>, <span class="hljs-string">&quot;~&gt; 0.4&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:telemetry_poller</span>, <span class="hljs-string">&quot;~&gt; 0.4&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:gettext</span>, <span class="hljs-string">&quot;~&gt; 0.11&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:jason</span>, <span class="hljs-string">&quot;~&gt; 1.0&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:plug_cowboy</span>, <span class="hljs-string">&quot;~&gt; 2.0&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:phoenix_live_view</span>, <span class="hljs-string">&quot;~&gt; 0.15.4&quot;</span>, <span class="hljs-symbol">override:</span> <span class="hljs-keyword">true</span>&#125;,<br>     &#123;<span class="hljs-symbol">:timex</span>, <span class="hljs-string">&quot;~&gt; 3.6&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:faker</span>, <span class="hljs-string">&quot;~&gt; 0.16.0&quot;</span>&#125;,<br>     &#123;<span class="hljs-symbol">:phx_gen_auth</span>, <span class="hljs-string">&quot;~&gt; 0.7&quot;</span>, <span class="hljs-symbol">only:</span> [<span class="hljs-symbol">:dev</span>], <span class="hljs-symbol">runtime:</span> <span class="hljs-keyword">false</span>&#125;<br>   ]<br> <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>安装并编译依赖项</p>
<p><code>$ mix do deps.get, deps.compile</code></p>
<p>使用以下命令安装身份验证系统：</p>
<p><code>$ mix phx.gen.auth Accounts User users</code></p>
<p>生成所有文件后运行以下命令：</p>
<p><code>$ mix deps.get &amp;&amp; mix ecto.migrate</code></p>
<p>现在我们需要通过运行以下命令向用户表添加一些字段：</p>
<p><code>$ mix ecto.gen.migration add_to_users_table</code></p>
<p>然后打开生成的文件<code>priv/repo/migrations/20210409223611_add_to_users_table.exs</code>并添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramClone.Repo.Migrations.AddToUsersTable</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> Ecto.Migration<br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span> <span class="hljs-keyword">do</span><br>    alter table(<span class="hljs-symbol">:users</span>) <span class="hljs-keyword">do</span><br>      add <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">:string</span><br>      add <span class="hljs-symbol">:full_name</span>, <span class="hljs-symbol">:string</span><br>      add <span class="hljs-symbol">:avatar_url</span>, <span class="hljs-symbol">:string</span><br>      add <span class="hljs-symbol">:bio</span>, <span class="hljs-symbol">:string</span><br>      add <span class="hljs-symbol">:website</span>, <span class="hljs-symbol">:string</span><br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>然后<code>$ mix ecto.migrate</code></p>
<p>接下来打开<code>lib/instagram_clone/accounts/user.ex</code>并将以下内容添加到您的用户架构中：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">field <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">:string</span><br>field <span class="hljs-symbol">:full_name</span>, <span class="hljs-symbol">:string</span><br>field <span class="hljs-symbol">:avatar_url</span>, <span class="hljs-symbol">:string</span>, <span class="hljs-symbol">default:</span> <span class="hljs-string">&quot;/images/default-avatar.png&quot;</span><br>field <span class="hljs-symbol">:bio</span>, <span class="hljs-symbol">:string</span><br>field <span class="hljs-symbol">:website</span>, <span class="hljs-symbol">:string</span><br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://s2.loli.net/2023/08/30/VAJIaFk1Krbm3fN.png" alt="instagram-phoenix-p1-2.png" class="lazyload"></p>
<p>下载上面的默认头像图像并将其重命名为<code>default-avatar.png</code>并将该图像添加到<code>priv/static/images</code></p>
<p>现在我们需要为新用户架构添加验证，因此<code>lib/instagram_clone/accounts/user.ex</code>再次打开并将其更改<code>registration_changeset</code>为以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">registration_changeset</span></span>(user, attrs, opts \\ []) <span class="hljs-keyword">do</span><br>  user<br>  |&gt; cast(attrs, [<span class="hljs-symbol">:email</span>, <span class="hljs-symbol">:password</span>, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">:full_name</span>, <span class="hljs-symbol">:avatar_url</span>, <span class="hljs-symbol">:bio</span>, <span class="hljs-symbol">:website</span>])<br>  |&gt; validate_required([<span class="hljs-symbol">:username</span>, <span class="hljs-symbol">:full_name</span>])<br>  |&gt; validate_length(<span class="hljs-symbol">:username</span>, <span class="hljs-symbol">min:</span> <span class="hljs-number">5</span>, <span class="hljs-symbol">max:</span> <span class="hljs-number">30</span>)<br>  |&gt; validate_format(<span class="hljs-symbol">:username</span>, <span class="hljs-string">~r/^[a-zA-Z0-9_.-]*$/</span>, <span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;Please use letters and numbers without space(only characters allowed _ . -)&quot;</span>)<br>  |&gt; unique_constraint(<span class="hljs-symbol">:username</span>)<br>  |&gt; validate_length(<span class="hljs-symbol">:full_name</span>, <span class="hljs-symbol">min:</span> <span class="hljs-number">4</span>, <span class="hljs-symbol">max:</span> <span class="hljs-number">30</span>)<br>  |&gt; validate_email()<br>  |&gt; validate_password(opts)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>此外，我们需要更改我们的<code>validate_password</code>函数，以便在更新用户帐户时，我们不需要验证或散列密码，因此将其更改为以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">validate_password</span></span>(changeset, opts) <span class="hljs-keyword">do</span><br>  register_user? = Keyword.get(opts, <span class="hljs-symbol">:register_user</span>, <span class="hljs-keyword">true</span>)<br>  if register_user? <span class="hljs-keyword">do</span><br>    changeset<br>    |&gt; validate_required([<span class="hljs-symbol">:password</span>])<br>    |&gt; validate_length(<span class="hljs-symbol">:password</span>, <span class="hljs-symbol">min:</span> <span class="hljs-number">6</span>, <span class="hljs-symbol">max:</span> <span class="hljs-number">80</span>)<br>    <span class="hljs-comment"># |&gt; validate_format(:password, ~r/[a-z]/, message: &quot;at least one lower case character&quot;)</span><br>    <span class="hljs-comment"># |&gt; validate_format(:password, ~r/[A-Z]/, message: &quot;at least one upper case character&quot;)</span><br>    <span class="hljs-comment"># |&gt; validate_format(:password, ~r/[!?@#$%^&amp;*_0-9]/, message: &quot;at least one digit or punctuation character&quot;)</span><br>    |&gt; maybe_hash_password(opts)<br>  else<br>    changeset<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>更新用户帐户时，我们将向<code>register_user: false</code>变更集发送一个选项。此外，出于开发目的，最小密码长度已更改为 6，但应在生产中更改。</p>
<p>让我们运行我们的服务器<code>$ iex -S mix phx.server</code>并打开<code>/lib/instagram_clone_web/live/page_live.html.leex</code>我们的主页样式以添加注册表单。</p>
<p>在执行此操作之前，我们必须删除 phx.gen.auth 自动生成的身份验证链接，因此请转到正文顶部<code>/lib/instagram_clone_web/templates/layout/root.html.leex</code>并将其删除。<code>&lt;%= render &quot;_user_menu.html&quot;, assigns %&gt;</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>  &lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>/&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> content=<span class="hljs-string">&quot;IE=edge&quot;</span>/&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>/&gt;<br>    &lt;%= csrf_meta_tag() %&gt;<br>    &lt;%= live_title_tag assigns[<span class="hljs-symbol">:page_title</span>] || <span class="hljs-string">&quot;InstagramClone&quot;</span>, <span class="hljs-symbol">suffix:</span> <span class="hljs-string">&quot; · Phoenix Framework&quot;</span> %&gt;<br>    &lt;link phx-track-static rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;&lt;%= Routes.static_path(@conn, &quot;</span>/css/app.css<span class="hljs-string">&quot;) %&gt;&quot;</span>/&gt;<br>    &lt;script defer phx-track-static type=<span class="hljs-string">&quot;text/javascript&quot;</span> src=<span class="hljs-string">&quot;&lt;%= Routes.static_path(@conn, &quot;</span>/js/app.js<span class="hljs-string">&quot;) %&gt;&quot;</span>&gt;&lt;<span class="hljs-regexp">/script&gt;</span><br><span class="hljs-regexp">  &lt;/head</span>&gt;<br>  &lt;body&gt;<br>    &lt;%= render <span class="hljs-string">&quot;_user_menu.html&quot;</span>, assigns %&gt;&lt;!-- REMOVE IT --&gt;<br>    &lt;%= <span class="hljs-variable">@inner_content</span> %&gt;<br>  &lt;<span class="hljs-regexp">/body&gt;</span><br><span class="hljs-regexp">&lt;/html</span>&gt;<br></code></pre></td></tr></table></figure>

<p>最后，删除<code>/lib/instagram_clone_web/templates/layout/_user_menu.html.eex</code>部分文件，我们不需要它。</p>
<p>好的，现在回来<code>/lib/instagram_clone_web/live/page_live.html.leex</code>添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow-lg flex flex-col place-items-center mx-auto p-6&quot;</span>&gt;<br>    &lt;h1 class=<span class="hljs-string">&quot;text-4xl font-bold italic text-gray-600&quot;</span>&gt;InstagramClone&lt;<span class="hljs-regexp">/h1&gt;</span><br><span class="hljs-regexp">    &lt;p class=&quot;text-gray-400 font-semibold text-lg my-6&quot;&gt;Sign up to see photos and videos from your friends.&lt;/p</span>&gt;<br>&lt;<span class="hljs-regexp">/section&gt;</span><br></code></pre></td></tr></table></figure>

<p>我们需要添加一个表单，因此将<code>/lib/instagram_clone_web/live/page_live.ex</code> mount 函数更改为以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-keyword">alias</span> InstagramClone.Accounts<br><span class="hljs-keyword">alias</span> InstagramClone.Accounts.User<br><br><span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mount</span></span>(_params, _session, socket) <span class="hljs-keyword">do</span><br>  changeset = Accounts.change_user_registration(%User&#123;&#125;)<br>  &#123;<span class="hljs-symbol">:ok</span>,<br>    socket<br>    |&gt; assign(<span class="hljs-symbol">changeset:</span> changeset)&#125;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>让我们通过编辑来添加表单和新样式<code>/lib/instagram_clone_web/live/page_live.html.leex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow flex flex-col place-items-center mx-auto p-6&quot;</span>&gt;<br>  &lt;h1 class=<span class="hljs-string">&quot;text-4xl font-bold italic text-gray-700&quot;</span>&gt;InstagramClone&lt;<span class="hljs-regexp">/h1&gt;</span><br><span class="hljs-regexp">  &lt;p class=&quot;text-gray-500 font-semibold text-lg mt-6 text-center px-8&quot;&gt;Sign up to see photos and videos from your friends.&lt;/p</span>&gt;<br><br>  &lt;%= f = form_for <span class="hljs-variable">@changeset</span>, <span class="hljs-string">&quot;#&quot;</span>,<br>    <span class="hljs-symbol">phx_change:</span> <span class="hljs-string">&quot;validate&quot;</span>,<br>    <span class="hljs-symbol">phx_submit:</span> <span class="hljs-string">&quot;save&quot;</span>,<br>    <span class="hljs-symbol">phx_trigger_action:</span> <span class="hljs-variable">@trigger_submit</span>,<br>    <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;flex flex-col space-y-4 w-full px-6&quot;</span> %&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;flex flex-col&quot;</span>&gt;<br>      &lt;%= label f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-gray-400&quot;</span> %&gt;<br>      &lt;%= email_input f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot;</span> %&gt;<br>      &lt;%= error_tag f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-red-700 text-sm&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;flex flex-col&quot;&gt;</span><br><span class="hljs-regexp">      &lt;%= label f, :full_name, class: &quot;text-gray-400&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= text_input f, :full_name, class: &quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= error_tag f, :full_name, class: &quot;text-red-700 text-sm&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;flex flex-col&quot;</span>&gt;<br>      &lt;%= label f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-gray-400&quot;</span> %&gt;<br>      &lt;%= text_input f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot;</span> %&gt;<br>      &lt;%= error_tag f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-red-700 text-sm&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;flex flex-col&quot;&gt;</span><br><span class="hljs-regexp">      &lt;%= label f, :password, class: &quot;text-gray-400&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= password_input f, :password, class: &quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= error_tag f, :password, class: &quot;text-red-700 text-sm&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div&gt;<br>      &lt;%= submit <span class="hljs-string">&quot;Sign up&quot;</span>, <span class="hljs-symbol">phx_disable_with:</span> <span class="hljs-string">&quot;Saving...&quot;</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;block w-full py-2 border-none shadow rounded font-semibold text-sm text-gray-50 hover:bg-light-blue-600 bg-light-blue-500 cursor-pointer&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">  &lt;/form</span>&gt;<br><br>  &lt;p class=<span class="hljs-string">&quot;text-sm px-10 text-center mt-6 text-gray-400 font-semibold&quot;</span>&gt;By signing up, you agree to our Terms , Data Policy <span class="hljs-keyword">and</span> Cookies Policy .&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">&lt;/section</span>&gt;<br><br>&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow flex justify-center mx-auto p-6 mt-6&quot;</span>&gt;<br>  &lt;p class=<span class="hljs-string">&quot;text-lg text-gray-600&quot;</span>&gt;Have an account? &lt;%= link <span class="hljs-string">&quot;Log in&quot;</span>, <span class="hljs-symbol">to:</span> Routes.user_session_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:new</span>), <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-light-blue-500 font-semibold&quot;</span> %&gt;&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">&lt;/section</span>&gt;<br></code></pre></td></tr></table></figure>

<p><code>error_tag()</code>在继续之前，我们需要稍微调整一下我们的辅助函数，这样我们就可以向其中添加类，打开<code>lib/instagram_clone_web/views/error_helpers.ex</code>文件并将函数更改为以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error_tag</span></span>(form, field, class \\ [<span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;invalid-feedback&quot;</span>]) <span class="hljs-keyword">do</span><br>  Enum.map(Keyword.get_values(form.errors, field), <span class="hljs-keyword">fn</span> error -&gt;<br>    content_tag(<span class="hljs-symbol">:span</span>, translate_error(error),<br>      <span class="hljs-symbol">class:</span> Keyword.get(class, <span class="hljs-symbol">:class</span>),<br>      <span class="hljs-symbol">phx_feedback_for:</span> input_id(form, field)<br>    )<br>  <span class="hljs-keyword">end</span>)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://s2.loli.net/2023/08/30/7H3adh9Zj6XNzkb.jpg" alt="instagram-phoenix-p1-3.jpg" class="lazyload"></p>
<p>这将作为我们的基础登陆和注册页面。我们需要添加我们的<code>validation()</code>和<code>save()</code>函数，并分配<code>trigger_submit</code>给 mount 函数中的套接字，以便能够通过 HTTP 触发表单，将表单直接发送到我们的<code>/lib/instagram_clone_web/live/page_live.ex</code> liveview 模块上的注册控制器，以便我们可以注册我们的用户，所以让我们这样做下一个。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mount</span></span>(_params, _session, socket) <span class="hljs-keyword">do</span><br>  changeset = Accounts.change_user_registration(%User&#123;&#125;)<br>  &#123;<span class="hljs-symbol">:ok</span>,<br>    socket<br>    |&gt; assign(<span class="hljs-symbol">changeset:</span> changeset)<br>    |&gt; assign(<span class="hljs-symbol">trigger_submit:</span> <span class="hljs-keyword">false</span>)&#125;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_event</span></span>(<span class="hljs-string">&quot;validate&quot;</span>, %&#123;<span class="hljs-string">&quot;user&quot;</span> =&gt; user_params&#125;, socket) <span class="hljs-keyword">do</span><br>  changeset =<br>    %User&#123;&#125;<br>    |&gt; User.registration_changeset(user_params)<br>    |&gt; Map.put(<span class="hljs-symbol">:action</span>, <span class="hljs-symbol">:validate</span>)<br>  <span class="hljs-symbol">:timer</span>.sleep(<span class="hljs-number">9000</span>)<br>  &#123;<span class="hljs-symbol">:noreply</span>, socket |&gt; assign(<span class="hljs-symbol">changeset:</span> changeset)&#125;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_event</span></span>(<span class="hljs-string">&quot;save&quot;</span>, _, socket) <span class="hljs-keyword">do</span><br>  &#123;<span class="hljs-symbol">:noreply</span>, assign(socket, <span class="hljs-symbol">trigger_submit:</span> <span class="hljs-keyword">true</span>)&#125;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>为了处理和显示错误，我们必须编辑我们的注册用户页面，因为它们是由控制器处理的常规 Phoenix 视图，所以它应该看起来像我们的实时视图。在此之前，我们必须向容器中的主标记添加一个类以用于常规视图，打开<code>lib/instagram_clone_web/templates/layout/app.html.eex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;main role=<span class="hljs-string">&quot;main&quot;</span> class=<span class="hljs-string">&quot;container mx-auto max-w-full md:w-11/12 2xl:w-6/12 pt-24&quot;</span>&gt;<br>  &lt;p class=<span class="hljs-string">&quot;alert alert-info&quot;</span> role=<span class="hljs-string">&quot;alert&quot;</span>&gt;&lt;%= get_flash(<span class="hljs-variable">@conn</span>, <span class="hljs-symbol">:info</span>) %&gt;&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">  &lt;p class=&quot;alert alert-danger&quot; role=&quot;alert&quot;&gt;&lt;%= get_flash(@conn, :error) %&gt;&lt;/p</span>&gt;<br>  &lt;%= <span class="hljs-variable">@inner_content</span> %&gt;<br>&lt;<span class="hljs-regexp">/main&gt;</span><br></code></pre></td></tr></table></figure>

<p>然后使用以下内容打开<code>lib/instagram_clone_web/templates/user_registration/new.html.eex</code>并编辑该文件：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow flex flex-col place-items-center mx-auto p-6&quot;</span>&gt;<br>  &lt;h1 class=<span class="hljs-string">&quot;text-4xl font-bold italic text-gray-700&quot;</span>&gt;InstagramClone&lt;<span class="hljs-regexp">/h1&gt;</span><br><span class="hljs-regexp">  &lt;p class=&quot;text-gray-500 font-semibold text-lg mt-6 text-center px-8&quot;&gt;Sign up to see photos and videos from your friends.&lt;/p</span>&gt;<br><br>  &lt;%= form_for <span class="hljs-variable">@changeset</span>, Routes.user_registration_path(<span class="hljs-variable">@conn</span>, <span class="hljs-symbol">:create</span>), [<span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;flex flex-col space-y-4 w-full px-6&quot;</span>], <span class="hljs-keyword">fn</span> f -&gt; %&gt;<br>    &lt;%= if <span class="hljs-variable">@changeset</span>.action <span class="hljs-keyword">do</span> %&gt;<br>      &lt;div class=<span class="hljs-string">&quot;alert alert-danger&quot;</span>&gt;<br>        &lt;p&gt;Oops, something went wrong! Please check the errors below.&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">      &lt;/div</span>&gt;<br>    &lt;% <span class="hljs-keyword">end</span> %&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;flex flex-col&quot;</span>&gt;<br>      &lt;%= label f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-gray-400&quot;</span> %&gt;<br>      &lt;%= email_input f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot;</span> %&gt;<br>      &lt;%= error_tag f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-red-700 text-sm&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;flex flex-col&quot;&gt;</span><br><span class="hljs-regexp">      &lt;%= label f, :full_name, class: &quot;text-gray-400&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= text_input f, :full_name, class: &quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= error_tag f, :full_name, class: &quot;text-red-700 text-sm&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;flex flex-col&quot;</span>&gt;<br>      &lt;%= label f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-gray-400&quot;</span> %&gt;<br>      &lt;%= text_input f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot;</span> %&gt;<br>      &lt;%= error_tag f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-red-700 text-sm&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;flex flex-col&quot;&gt;</span><br><span class="hljs-regexp">      &lt;%= label f, :password, class: &quot;text-gray-400&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= password_input f, :password, class: &quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= error_tag f, :password, class: &quot;text-red-700 text-sm&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div&gt;<br>      &lt;%= submit <span class="hljs-string">&quot;Sign up&quot;</span>, <span class="hljs-symbol">phx_disable_with:</span> <span class="hljs-string">&quot;Saving...&quot;</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;block w-full py-2 border-none shadow rounded font-semibold text-sm text-gray-50 hover:bg-light-blue-600 bg-light-blue-500 cursor-pointer&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">  &lt;% end %&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">  &lt;p class=&quot;text-sm px-10 text-center mt-6 text-gray-400 font-semibold&quot;&gt;By signing up, you agree to our Terms , Data Policy and Cookies Policy .&lt;/p</span>&gt;<br>&lt;<span class="hljs-regexp">/section&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">&lt;section class=&quot;w-1/</span><span class="hljs-number">2</span> border<span class="hljs-number">-2</span> shadow flex justify-center mx-auto p<span class="hljs-number">-6</span> mt<span class="hljs-number">-6</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">  &lt;p class=&quot;</span>text-lg text-gray<span class="hljs-number">-600</span><span class="hljs-string">&quot;&gt;Have an account? &lt;%= link &quot;</span>Log <span class="hljs-keyword">in</span><span class="hljs-string">&quot;, to: Routes.user_session_path(@conn, :new), class: &quot;</span>text-light-blue<span class="hljs-number">-500</span> font-semibold<span class="hljs-string">&quot; %&gt;&lt;/p&gt;</span><br><span class="hljs-string">&lt;/section&gt;</span><br></code></pre></td></tr></table></figure>

<p>让我们设计登录页面并登录。打开<code>lib/instagram_clone_web/templates/user_session/new.html.eex</code>并添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow flex flex-col place-items-center mx-auto p-6&quot;</span>&gt;<br>  &lt;h1 class=<span class="hljs-string">&quot;text-4xl font-bold italic text-gray-700&quot;</span>&gt;InstagramClone&lt;<span class="hljs-regexp">/h1&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">  &lt;%= form_for @conn, Routes.user_session_path(@conn, :create), [as: :user, class: &quot;flex flex-col space-y-4 w-full px-6&quot;], fn f -&gt; %&gt;</span><br><span class="hljs-regexp">    &lt;%= if @error_message do %&gt;</span><br><span class="hljs-regexp">      &lt;div class=&quot;alert alert-danger&quot;&gt;</span><br><span class="hljs-regexp">        &lt;p&gt;&lt;%= @error_message %&gt;&lt;/p</span>&gt;<br>      &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">    &lt;% end %&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;flex flex-col&quot;&gt;</span><br><span class="hljs-regexp">      &lt;%= label f, :email, class: &quot;text-gray-400&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= email_input f, :email, class: &quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= error_tag f, :email, class: &quot;text-red-700 text-sm&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;flex flex-col&quot;</span>&gt;<br>      &lt;%= label f, <span class="hljs-symbol">:password</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-gray-400&quot;</span> %&gt;<br>      &lt;%= password_input f, <span class="hljs-symbol">:password</span>, <span class="hljs-symbol">value:</span> input_value(f, <span class="hljs-symbol">:password</span>), <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot;</span> %&gt;<br>      &lt;%= error_tag f, <span class="hljs-symbol">:password</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-red-700 text-sm&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div&gt;</span><br><span class="hljs-regexp">      &lt;%= submit &quot;Log In&quot;, phx_disable_with: &quot;Saving...&quot;, class: &quot;block w-full py-2 border-none shadow rounded font-semibold text-sm text-gray-50 hover:bg-light-blue-600 bg-light-blue-500 cursor-pointer&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br>  &lt;% <span class="hljs-keyword">end</span> %&gt;<br><br>  &lt;p class=<span class="hljs-string">&quot;text-sm px-10 text-center mt-6 text-gray-400 font-semibold&quot;</span>&gt;&lt;%= link <span class="hljs-string">&quot;Forgot password?&quot;</span>, <span class="hljs-symbol">to:</span> Routes.user_reset_password_path(<span class="hljs-variable">@conn</span>, <span class="hljs-symbol">:new</span>) %&gt;&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">&lt;/section</span>&gt;<br><br>&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow flex justify-center mx-auto p-6 mt-6&quot;</span>&gt;<br>  &lt;p class=<span class="hljs-string">&quot;text-lg text-gray-600&quot;</span>&gt;Don<span class="hljs-string">&#x27;t have an account? &lt;%= link &quot;Sign up&quot;, to: Routes.user_registration_path(@conn, :new), class: &quot;text-light-blue-500 font-semibold&quot; %&gt;&lt;/p&gt;</span><br><span class="hljs-string">&lt;/section&gt;</span><br></code></pre></td></tr></table></figure>

<p>它应该如下图所示。</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://s2.loli.net/2023/08/30/9fBiej2YJF7soHR.jpg" alt="instagram-phoenix-p1-4.jpg" class="lazyload"></p>
<p>事情变得非常有趣和令人兴奋，但我们没有办法在实时视图中获取当前登录的用户，我们必须在每个实时视图安装上手动获取它，我们可以手动执行此操作，但我们很懒，所以我们将添加一个我们可以调用并有权访问当前用户的辅助函数。</p>
<p>将新文件添加到<code>lib/instagram_clone_web/live</code>名为的文件夹中<code>lib/instagram_clone_web/live/live_helpers.ex</code>并添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramCloneWeb.LiveHelpers</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">import</span> Phoenix.LiveView<br>  <span class="hljs-keyword">alias</span> InstagramClone.Accounts<br>  <span class="hljs-keyword">alias</span> InstagramClone.Accounts.User<br>  <span class="hljs-keyword">alias</span> InstagramCloneWeb.UserAuth<br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">assign_defaults</span></span>(session, socket) <span class="hljs-keyword">do</span><br>    if connected?(socket), <span class="hljs-symbol">do:</span> InstagramCloneWeb.Endpoint.subscribe(UserAuth.pubsub_topic())<br><br>    socket =<br>      assign_new(socket, <span class="hljs-symbol">:current_user</span>, <span class="hljs-keyword">fn</span> -&gt;<br>        find_current_user(session)<br>      <span class="hljs-keyword">end</span>)<br>    socket<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">find_current_user</span></span>(session) <span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">with</span> user_token <span class="hljs-keyword">when</span> <span class="hljs-keyword">not</span> is_nil(user_token) &lt;- session[<span class="hljs-string">&quot;user_token&quot;</span>],<br>         %User&#123;&#125; = user &lt;- Accounts.get_user_by_session_token(user_token),<br>         <span class="hljs-symbol">do:</span> user<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>很简单，我们找到带有会话令牌的当前用户并将其分配回套接字，我们还订阅了一个 pubsub 主题，以便在使用套接字登录时注销所有实时当前会话，接下来让我们创建该函数，打开并<code>lib/instagram_clone_web/controllers/user_auth.ex</code>添加下列的：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-comment"># Added to the top of our file</span><br><span class="hljs-variable">@pubsub_topic</span> <span class="hljs-string">&quot;user_updates&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pubsub_topic</span></span>, <span class="hljs-symbol">do:</span> <span class="hljs-variable">@pubsub_topic</span><br><span class="hljs-comment"># We changed a line on this function</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log_out_user</span></span>(conn) <span class="hljs-keyword">do</span><br>  user_token = get_session(conn, <span class="hljs-symbol">:user_token</span>)<br>  Accounts.log_out_user(user_token) <span class="hljs-comment">#Line changed</span><br><br>  if live_socket_id = get_session(conn, <span class="hljs-symbol">:live_socket_id</span>) <span class="hljs-keyword">do</span><br>    InstagramCloneWeb.Endpoint.broadcast(live_socket_id, <span class="hljs-string">&quot;disconnect&quot;</span>, %&#123;&#125;)<br>  <span class="hljs-keyword">end</span><br><br>  conn<br>  |&gt; renew_session()<br>  |&gt; delete_resp_cookie(<span class="hljs-variable">@remember_me_cookie</span>)<br>  |&gt; redirect(<span class="hljs-symbol">to:</span> <span class="hljs-string">&quot;/&quot;</span>)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>现在让我们将<code>log_out_user()</code>函数添加到我们的<code>Accounts</code>上下文中，打开<code>lib/instagram_clone/accounts.ex</code>添加：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs elixir">...<br><br><span class="hljs-keyword">alias</span> InstagramCloneWeb.UserAuth<br><br>...<br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log_out_user</span></span>(token) <span class="hljs-keyword">do</span><br>    user = get_user_by_session_token(token)<br>    <span class="hljs-comment"># Delete all user tokens</span><br>    Repo.delete_all(UserToken.user_and_contexts_query(user, <span class="hljs-symbol">:all</span>))<br><br>    <span class="hljs-comment"># Broadcast to all liveviews to immediately disconnect the user</span><br>    InstagramCloneWeb.Endpoint.broadcast_from(<br>      <span class="hljs-keyword">self</span>(),<br>      UserAuth.pubsub_topic(),<br>      <span class="hljs-string">&quot;logout_user&quot;</span>,<br>      %&#123;<br>        <span class="hljs-symbol">user:</span> user<br>      &#125;<br>    )<br>  <span class="hljs-keyword">end</span><br><br>...<br></code></pre></td></tr></table></figure>

<p>现在我们必须在实时视图中提供辅助函数，打开<code>lib/instagram_clone_web.ex</code>并添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">live_view</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">quote</span> <span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">use</span> Phoenix.LiveView,<br>      <span class="hljs-symbol">layout:</span> &#123;InstagramCloneWeb.LayoutView, <span class="hljs-string">&quot;live.html&quot;</span>&#125;<br><br>    unquote(view_helpers())<br>    <span class="hljs-comment"># Added Start   </span><br>    <span class="hljs-keyword">import</span> InstagramCloneWeb.LiveHelpers<br><br>    <span class="hljs-keyword">alias</span> InstagramClone.Accounts.User<br>    <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_info</span></span>(%&#123;<span class="hljs-symbol">event:</span> <span class="hljs-string">&quot;logout_user&quot;</span>, <span class="hljs-symbol">payload:</span> %&#123;<span class="hljs-symbol">user:</span> %User&#123;<span class="hljs-symbol">id:</span> id&#125;&#125;&#125;, socket) <span class="hljs-keyword">do</span><br>      <span class="hljs-keyword">with</span> %User&#123;<span class="hljs-symbol">id:</span> ^id&#125; &lt;- socket.assigns.current_user <span class="hljs-keyword">do</span><br>        &#123;<span class="hljs-symbol">:noreply</span>,<br>          socket<br>          |&gt; redirect(<span class="hljs-symbol">to:</span> <span class="hljs-string">&quot;/&quot;</span>)<br>          |&gt; put_flash(<span class="hljs-symbol">:info</span>, <span class="hljs-string">&quot;Logged out successfully.&quot;</span>)&#125;<br>      else<br>        _any -&gt; &#123;<span class="hljs-symbol">:noreply</span>, socket&#125;<br>      <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-comment"># Added END </span><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>我们还添加了<code>handle_info()</code>自动对所有实时视图中的注销消息做出反应的功能。</p>
<p>打开<code>/lib/instagram_clone_web/live/page_live.ex</code>并将挂载函数更改为以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mount</span></span>(_params, session, socket) <span class="hljs-keyword">do</span><br>  socket = assign_defaults(session, socket)<br>  changeset = Accounts.change_user_registration(%User&#123;&#125;)<br>  &#123;<span class="hljs-symbol">:ok</span>,<br>    socket<br>    |&gt; assign(<span class="hljs-symbol">changeset:</span> changeset)<br>    |&gt; assign(<span class="hljs-symbol">trigger_submit:</span> <span class="hljs-keyword">false</span>)&#125;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>然后打开<code>/lib/instagram_clone_web/live/page_live.html.leex</code>文件并将其更改为以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;%= if <span class="hljs-variable">@current_user</span> <span class="hljs-keyword">do</span> %&gt;<br>  &lt;%= link <span class="hljs-string">&quot;Log Out&quot;</span>, <span class="hljs-symbol">to:</span> Routes.user_session_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:delete</span>), <span class="hljs-symbol">method:</span> <span class="hljs-symbol">:delete</span> %&gt;<br>  &lt;h1&gt;User Logged In Homepage&lt;<span class="hljs-regexp">/h1&gt;</span><br><span class="hljs-regexp">&lt;% else %&gt;</span><br><span class="hljs-regexp">  &lt;section class=&quot;w-1/</span><span class="hljs-number">2</span> border<span class="hljs-number">-2</span> shadow flex flex-col place-items-center mx-auto p<span class="hljs-number">-6</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">    &lt;h1 class=&quot;</span>text<span class="hljs-number">-4</span>xl font-bold italic text-gray<span class="hljs-number">-700</span><span class="hljs-string">&quot;&gt;InstagramClone&lt;/h1&gt;</span><br><span class="hljs-string">    &lt;p class=&quot;</span>text-gray<span class="hljs-number">-500</span> font-semibold text-lg mt<span class="hljs-number">-6</span> text-center px<span class="hljs-number">-8</span><span class="hljs-string">&quot;&gt;Sign up to see photos and videos from your friends.&lt;/p&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &lt;%= f = form_for @changeset, Routes.user_registration_path(@socket, :create),</span><br><span class="hljs-string">      phx_change: &quot;</span>validate<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      phx_submit: &quot;</span>save<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      phx_trigger_action: @trigger_submit,</span><br><span class="hljs-string">      class: &quot;</span>flex flex-col space-y<span class="hljs-number">-4</span> w-full px<span class="hljs-number">-6</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;div class=&quot;</span>flex flex-col<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">        &lt;%= label f, :email, class: &quot;</span>text-gray<span class="hljs-number">-400</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= email_input f, :email, class: &quot;</span>rounded border-gray<span class="hljs-number">-300</span> shadow-sm <span class="hljs-symbol">focus:</span>ring-gray<span class="hljs-number">-900</span> <span class="hljs-symbol">focus:</span>ring-opacity<span class="hljs-number">-50</span> <span class="hljs-symbol">focus:</span>border-gray<span class="hljs-number">-900</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= error_tag f, :email, class: &quot;</span>text-red<span class="hljs-number">-700</span> text-sm<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;div class=&quot;</span>flex flex-col<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">        &lt;%= label f, :full_name, class: &quot;</span>text-gray<span class="hljs-number">-400</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= text_input f, :full_name, class: &quot;</span>rounded border-gray<span class="hljs-number">-300</span> shadow-sm <span class="hljs-symbol">focus:</span>ring-gray<span class="hljs-number">-900</span> <span class="hljs-symbol">focus:</span>ring-opacity<span class="hljs-number">-50</span> <span class="hljs-symbol">focus:</span>border-gray<span class="hljs-number">-900</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= error_tag f, :full_name, class: &quot;</span>text-red<span class="hljs-number">-700</span> text-sm<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;div class=&quot;</span>flex flex-col<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">        &lt;%= label f, :username, class: &quot;</span>text-gray<span class="hljs-number">-400</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= text_input f, :username, class: &quot;</span>rounded border-gray<span class="hljs-number">-300</span> shadow-sm <span class="hljs-symbol">focus:</span>ring-gray<span class="hljs-number">-900</span> <span class="hljs-symbol">focus:</span>ring-opacity<span class="hljs-number">-50</span> <span class="hljs-symbol">focus:</span>border-gray<span class="hljs-number">-900</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= error_tag f, :username, class: &quot;</span>text-red<span class="hljs-number">-700</span> text-sm<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;div class=&quot;</span>flex flex-col<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">        &lt;%= label f, :password, class: &quot;</span>text-gray<span class="hljs-number">-400</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= password_input f, :password, value: input_value(f, :password), class: &quot;</span>rounded border-gray<span class="hljs-number">-300</span> shadow-sm <span class="hljs-symbol">focus:</span>ring-gray<span class="hljs-number">-900</span> <span class="hljs-symbol">focus:</span>ring-opacity<span class="hljs-number">-50</span> <span class="hljs-symbol">focus:</span>border-gray<span class="hljs-number">-900</span><span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">        &lt;%= error_tag f, :password, class: &quot;</span>text-red<span class="hljs-number">-700</span> text-sm<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;div&gt;</span><br><span class="hljs-string">        &lt;%= submit &quot;</span>Sign up<span class="hljs-string">&quot;, phx_disable_with: &quot;</span>Saving...<span class="hljs-string">&quot;, class: &quot;</span>block w-full py<span class="hljs-number">-2</span> border-none shadow rounded font-semibold text-sm text-gray<span class="hljs-number">-50</span> <span class="hljs-symbol">hover:</span>bg-light-blue<span class="hljs-number">-600</span> bg-light-blue<span class="hljs-number">-500</span> cursor-pointer<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &lt;p class=&quot;</span>text-sm px<span class="hljs-number">-10</span> text-center mt<span class="hljs-number">-6</span> text-gray<span class="hljs-number">-400</span> font-semibold<span class="hljs-string">&quot;&gt;By signing up, you agree to our Terms , Data Policy and Cookies Policy .&lt;/p&gt;</span><br><span class="hljs-string">  &lt;/section&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  &lt;section class=&quot;</span>w<span class="hljs-number">-1</span>/<span class="hljs-number">2</span> border<span class="hljs-number">-2</span> shadow flex justify-center mx-auto p<span class="hljs-number">-6</span> mt<span class="hljs-number">-6</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">    &lt;p class=&quot;</span>text-lg text-gray<span class="hljs-number">-600</span><span class="hljs-string">&quot;&gt;Have an account? &lt;%= link &quot;</span>Log <span class="hljs-keyword">in</span><span class="hljs-string">&quot;, to: Routes.user_session_path(@socket, :new), class: &quot;</span>text-light-blue<span class="hljs-number">-500</span> font-semibold<span class="hljs-string">&quot; %&gt;&lt;/p&gt;</span><br><span class="hljs-string">  &lt;/section&gt;</span><br><span class="hljs-string">&lt;% end %&gt;</span><br></code></pre></td></tr></table></figure>

<p>此时，您应该重新加载服务器并通过登录和注销来测试您的主页。一切都应该工作正常，但是让我们组件化我们的主页，在下面<code>lib/instagram_clone_web/live</code>创建 2 个文件，<code>lib/instagram_clone_web/live/page_live_component.ex</code>然后<code>lib/instagram_clone_web/live/page_live_component.html.leex</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-comment">#lib/instagram_clone_web/live/page_live_component.ex</span><br><br><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramCloneWeb.PageLiveComponent</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> InstagramCloneWeb, <span class="hljs-symbol">:live_component</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>获取表格<code>lib/instagram_clone_web/live/page_live.html.leex</code>并将其添加到<code>lib/instagram_clone_web/live/page_live_component.html.leex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow flex flex-col place-items-center mx-auto p-6&quot;</span>&gt;<br>  &lt;h1 class=<span class="hljs-string">&quot;text-4xl font-bold italic text-gray-700&quot;</span>&gt;InstagramClone&lt;<span class="hljs-regexp">/h1&gt;</span><br><span class="hljs-regexp">  &lt;p class=&quot;text-gray-500 font-semibold text-lg mt-6 text-center px-8&quot;&gt;Sign up to see photos and videos from your friends.&lt;/p</span>&gt;<br><br>  &lt;%= f = form_for <span class="hljs-variable">@changeset</span>, Routes.user_registration_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:create</span>),<br>    <span class="hljs-symbol">phx_change:</span> <span class="hljs-string">&quot;validate&quot;</span>,<br>    <span class="hljs-symbol">phx_submit:</span> <span class="hljs-string">&quot;save&quot;</span>,<br>    <span class="hljs-symbol">phx_trigger_action:</span> <span class="hljs-variable">@trigger_submit</span>,<br>    <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;flex flex-col space-y-4 w-full px-6&quot;</span> %&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;flex flex-col&quot;</span>&gt;<br>      &lt;%= label f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-gray-400&quot;</span> %&gt;<br>      &lt;%= email_input f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot;</span> %&gt;<br>      &lt;%= error_tag f, <span class="hljs-symbol">:email</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-red-700 text-sm&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;flex flex-col&quot;&gt;</span><br><span class="hljs-regexp">      &lt;%= label f, :full_name, class: &quot;text-gray-400&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= text_input f, :full_name, class: &quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= error_tag f, :full_name, class: &quot;text-red-700 text-sm&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;flex flex-col&quot;</span>&gt;<br>      &lt;%= label f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-gray-400&quot;</span> %&gt;<br>      &lt;%= text_input f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot;</span> %&gt;<br>      &lt;%= error_tag f, <span class="hljs-symbol">:username</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-red-700 text-sm&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;flex flex-col&quot;&gt;</span><br><span class="hljs-regexp">      &lt;%= label f, :password, class: &quot;text-gray-400&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= password_input f, :password, value: input_value(f, :password), class: &quot;rounded border-gray-300 shadow-sm focus:ring-gray-900 focus:ring-opacity-50 focus:border-gray-900&quot; %&gt;</span><br><span class="hljs-regexp">      &lt;%= error_tag f, :password, class: &quot;text-red-700 text-sm&quot; %&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div&gt;<br>      &lt;%= submit <span class="hljs-string">&quot;Sign up&quot;</span>, <span class="hljs-symbol">phx_disable_with:</span> <span class="hljs-string">&quot;Saving...&quot;</span>, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;block w-full py-2 border-none shadow rounded font-semibold text-sm text-gray-50 hover:bg-light-blue-600 bg-light-blue-500 cursor-pointer&quot;</span> %&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">  &lt;/form</span>&gt;<br><br>  &lt;p class=<span class="hljs-string">&quot;text-sm px-10 text-center mt-6 text-gray-400 font-semibold&quot;</span>&gt;By signing up, you agree to our Terms , Data Policy <span class="hljs-keyword">and</span> Cookies Policy .&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">&lt;/section</span>&gt;<br><br>&lt;section class=<span class="hljs-string">&quot;w-1/2 border-2 shadow flex justify-center mx-auto p-6 mt-6&quot;</span>&gt;<br>  &lt;p class=<span class="hljs-string">&quot;text-lg text-gray-600&quot;</span>&gt;Have an account? &lt;%= link <span class="hljs-string">&quot;Log in&quot;</span>, <span class="hljs-symbol">to:</span> Routes.user_session_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:new</span>), <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;text-light-blue-500 font-semibold&quot;</span> %&gt;&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">&lt;/section</span>&gt;<br></code></pre></td></tr></table></figure>

<p>现在您的<code>lib/instagram_clone_web/live/page_live.html.leex</code>示例应该如下所示：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;%= if <span class="hljs-variable">@current_user</span> <span class="hljs-keyword">do</span> %&gt;<br>  &lt;h1&gt;User Logged In Homepage&lt;<span class="hljs-regexp">/h1&gt;</span><br><span class="hljs-regexp">&lt;% else %&gt;</span><br><span class="hljs-regexp">  &lt;%= live_component @socket, InstagramCloneWeb.PageLiveComponent, changeset: @changeset, trigger_submit: @trigger_submit %&gt;</span><br><span class="hljs-regexp">&lt;% end %&gt;</span><br></code></pre></td></tr></table></figure>

<p>这有助于我们清理代码，以便稍后我们开始为登录用户处理主页时。</p>
<p>最后让我们添加一个标题导航菜单组件。首先我们需要知道当前的 URL 路径，我们将使用宏为所有实时视图执行此操作，打开<code>lib/instagram_clone_web.ex</code>添加以下函数<code>live_view()</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_params</span></span>(_unsigned_params, uri, socket) <span class="hljs-keyword">do</span><br>  &#123;<span class="hljs-symbol">:noreply</span>,<br>    socket<br>    |&gt; assign(<span class="hljs-symbol">current_uri_path:</span> URI.parse(uri).path)&#125;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p><code>current_uri_path</code>这将使我们能够访问分配给套接字的所有实时视图的当前 URL 路径。因此，在我们的<code>lib/instagram_clone_web.ex</code>文件中，新更新的内容<code>live_view()</code>应如下所示：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs elixir">...<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">live_view</span></span> <span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">quote</span> <span class="hljs-keyword">do</span><br>      <span class="hljs-keyword">use</span> Phoenix.LiveView,<br>        <span class="hljs-symbol">layout:</span> &#123;InstagramCloneWeb.LayoutView, <span class="hljs-string">&quot;live.html&quot;</span>&#125;<br><br>      unquote(view_helpers())<br>      <span class="hljs-keyword">import</span> InstagramCloneWeb.LiveHelpers<br><br>      <span class="hljs-keyword">alias</span> InstagramClone.Accounts.User<br>      <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>      <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_info</span></span>(%&#123;<span class="hljs-symbol">event:</span> <span class="hljs-string">&quot;logout_user&quot;</span>, <span class="hljs-symbol">payload:</span> %&#123;<span class="hljs-symbol">user:</span> %User&#123;<span class="hljs-symbol">id:</span> id&#125;&#125;&#125;, socket) <span class="hljs-keyword">do</span><br>        <span class="hljs-keyword">with</span> %User&#123;<span class="hljs-symbol">id:</span> ^id&#125; &lt;- socket.assigns.current_user <span class="hljs-keyword">do</span><br>          &#123;<span class="hljs-symbol">:noreply</span>,<br>            socket<br>            |&gt; redirect(<span class="hljs-symbol">to:</span> <span class="hljs-string">&quot;/&quot;</span>)<br>            |&gt; put_flash(<span class="hljs-symbol">:info</span>, <span class="hljs-string">&quot;Logged out successfully.&quot;</span>)&#125;<br>        else<br>          _any -&gt; &#123;<span class="hljs-symbol">:noreply</span>, socket&#125;<br>        <span class="hljs-keyword">end</span><br>      <span class="hljs-keyword">end</span><br><br>      <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>      <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_params</span></span>(_unsigned_params, uri, socket) <span class="hljs-keyword">do</span><br>        &#123;<span class="hljs-symbol">:noreply</span>,<br>          socket<br>          |&gt; assign(<span class="hljs-symbol">current_uri_path:</span> URI.parse(uri).path)&#125;<br>      <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br>...<br></code></pre></td></tr></table></figure>

<p>现在在下面<code>lib/instagram_clone_web/live</code>添加 2 个文件，<code>header_nav_component.ex</code>以及<code>header_nav_component.html.leex</code>. 添加<code>lib/instagram_clone_web/live/header_nav_component.ex</code>以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramCloneWeb.HeaderNavComponent</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> InstagramCloneWeb, <span class="hljs-symbol">:live_component</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>将以下内容添加到<code>lib/instagram_clone_web/live/header_nav_component.html.leex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;div class=<span class="hljs-string">&quot;h-14 border-b-2 flex fixed w-full bg-white z-50&quot;</span>&gt;<br>  &lt;header class=<span class="hljs-string">&quot;flex items-center container mx-auto max-w-full md:w-11/12 2xl:w-6/12&quot;</span>&gt;<br>    &lt;%= live_patch <span class="hljs-symbol">to:</span> Routes.page_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>) <span class="hljs-keyword">do</span> %&gt;<br>      &lt;h1 class=<span class="hljs-string">&quot;text-2xl font-bold italic&quot;</span>&gt;<span class="hljs-comment">#InstagramClone&lt;/h1&gt;</span><br>    &lt;% <span class="hljs-keyword">end</span> %&gt;<br>    &lt;div class=<span class="hljs-string">&quot;w-2/5 flex justify-end&quot;</span>&gt;&lt;input type=<span class="hljs-string">&quot;search&quot;</span> placeholder=<span class="hljs-string">&quot;Search&quot;</span> class=<span class="hljs-string">&quot;h-7 bg-gray-50 shadow-sm border-gray-300 focus:ring-gray-300 focus:ring-opacity-50 focus:border-gray-400  px-0.5 rounded-sm&quot;</span>&gt;&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">    &lt;nav class=&quot;w-3/</span><span class="hljs-number">5</span> relative<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">      &lt;ul x-data=&quot;</span>&#123;<span class="hljs-symbol">open:</span> <span class="hljs-keyword">false</span>&#125;<span class="hljs-string">&quot; class=&quot;</span>flex justify-<span class="hljs-keyword">end</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">        &lt;%= if @current_user do %&gt;</span><br><span class="hljs-string">          &lt;li class=&quot;</span>w<span class="hljs-number">-7</span> h<span class="hljs-number">-7</span> text-gray<span class="hljs-number">-600</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;%= live_patch to: Routes.page_path(@socket, :index) do %&gt;</span><br><span class="hljs-string">              &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">                &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">2</span><span class="hljs-string">&quot; d=&quot;</span>M3 <span class="hljs-number">12</span>l2<span class="hljs-number">-2</span>m0 0l7<span class="hljs-number">-7</span> <span class="hljs-number">7</span> <span class="hljs-number">7</span>M5 <span class="hljs-number">10</span>v10a1 <span class="hljs-number">1</span> 0 001 <span class="hljs-number">1</span>h3m10<span class="hljs-number">-11</span>l2 <span class="hljs-number">2</span>m<span class="hljs-number">-2</span><span class="hljs-number">-2</span>v10a1 <span class="hljs-number">1</span> 0 01<span class="hljs-number">-1</span> <span class="hljs-number">1</span>h<span class="hljs-number">-3</span>m<span class="hljs-number">-6</span> 0a1 <span class="hljs-number">1</span> 0 001<span class="hljs-number">-1</span>v<span class="hljs-number">-4</span>a1 <span class="hljs-number">1</span> 0 011<span class="hljs-number">-1</span>h2a1 <span class="hljs-number">1</span> 0 011 <span class="hljs-number">1</span>v4a1 <span class="hljs-number">1</span> 0 001 <span class="hljs-number">1</span>m<span class="hljs-number">-6</span> 0h6<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">              &lt;/svg&gt;</span><br><span class="hljs-string">            &lt;% end %&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">          &lt;li class=&quot;</span>w<span class="hljs-number">-7</span> h<span class="hljs-number">-7</span> ml<span class="hljs-number">-6</span> text-gray<span class="hljs-number">-600</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;%= live_patch to: &quot;</span><span class="hljs-string">&quot; do %&gt;</span><br><span class="hljs-string">              &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">                &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">2</span><span class="hljs-string">&quot; d=&quot;</span>M12 <span class="hljs-number">9</span>v3m0 0v3m0<span class="hljs-number">-3</span>h3m<span class="hljs-number">-3</span> 0H9m12 0a9 <span class="hljs-number">9</span> 0 <span class="hljs-number">11</span><span class="hljs-number">-18</span> 0 <span class="hljs-number">9</span> <span class="hljs-number">9</span> 0 0118 0z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">              &lt;/svg&gt;</span><br><span class="hljs-string">            &lt;% end %&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">          &lt;li class=&quot;</span>w<span class="hljs-number">-7</span> h<span class="hljs-number">-7</span> ml<span class="hljs-number">-6</span> text-gray<span class="hljs-number">-600</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">              &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">2</span><span class="hljs-string">&quot; d=&quot;</span>M8 <span class="hljs-number">12</span>h.01M12 <span class="hljs-number">12</span>h.01M16 <span class="hljs-number">12</span>h.01M21 <span class="hljs-number">12</span>c0 <span class="hljs-number">4.418</span><span class="hljs-number">-4.03</span> <span class="hljs-number">8</span><span class="hljs-number">-9</span> <span class="hljs-number">8</span>a9.<span class="hljs-number">863</span> <span class="hljs-number">9.863</span> 0 01<span class="hljs-number">-4.255</span>-.<span class="hljs-number">949</span>L3 <span class="hljs-number">20</span>l1.<span class="hljs-number">395</span><span class="hljs-number">-3.72</span>C3.<span class="hljs-number">512</span> <span class="hljs-number">15.042</span> <span class="hljs-number">3</span> <span class="hljs-number">13.574</span> <span class="hljs-number">3</span> <span class="hljs-number">12</span>c0<span class="hljs-number">-4.418</span> <span class="hljs-number">4.03</span><span class="hljs-number">-8</span> <span class="hljs-number">9</span><span class="hljs-number">-8</span>s9 <span class="hljs-number">3.582</span> <span class="hljs-number">9</span> <span class="hljs-number">8</span>z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">            &lt;/svg&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">          &lt;li class=&quot;</span>w<span class="hljs-number">-7</span> h<span class="hljs-number">-7</span> ml<span class="hljs-number">-6</span> text-gray<span class="hljs-number">-600</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">              &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">2</span><span class="hljs-string">&quot; d=&quot;</span>M21 <span class="hljs-number">12</span>a9 <span class="hljs-number">9</span> 0 01<span class="hljs-number">-9</span> <span class="hljs-number">9</span>m9<span class="hljs-number">-9</span>a9 <span class="hljs-number">9</span> 0 00<span class="hljs-number">-9</span><span class="hljs-number">-9</span>m9 <span class="hljs-number">9</span>H3m9 <span class="hljs-number">9</span>a9 <span class="hljs-number">9</span> 0 01<span class="hljs-number">-9</span><span class="hljs-number">-9</span>m9 <span class="hljs-number">9</span>c1.<span class="hljs-number">657</span> 0 <span class="hljs-number">3</span><span class="hljs-number">-4.03</span> <span class="hljs-number">3</span><span class="hljs-number">-9</span>s<span class="hljs-number">-1.343</span><span class="hljs-number">-9</span><span class="hljs-number">-3</span><span class="hljs-number">-9</span>m0 <span class="hljs-number">18</span>c<span class="hljs-number">-1.657</span> 0<span class="hljs-number">-3</span><span class="hljs-number">-4.03</span><span class="hljs-number">-3</span><span class="hljs-number">-9</span>s1.<span class="hljs-number">343</span><span class="hljs-number">-9</span> <span class="hljs-number">3</span><span class="hljs-number">-9</span>m<span class="hljs-number">-9</span> <span class="hljs-number">9</span>a9 <span class="hljs-number">9</span> 0 019<span class="hljs-number">-9</span><span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">            &lt;/svg&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">          &lt;li class=&quot;</span>w<span class="hljs-number">-7</span> h<span class="hljs-number">-7</span> ml<span class="hljs-number">-6</span> text-gray<span class="hljs-number">-600</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">              &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">2</span><span class="hljs-string">&quot; d=&quot;</span>M4.<span class="hljs-number">318</span> <span class="hljs-number">6.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 000 <span class="hljs-number">6.364</span>L12 <span class="hljs-number">20.364</span>l7.<span class="hljs-number">682</span><span class="hljs-number">-7.682</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span><span class="hljs-number">-6.364</span>L12 <span class="hljs-number">7.636</span>l<span class="hljs-number">-1.318</span><span class="hljs-number">-1.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span> 0z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">            &lt;/svg&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">          &lt;li</span><br><span class="hljs-string">            @click=&quot;</span>open = <span class="hljs-keyword">true</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">            class=&quot;</span>w<span class="hljs-number">-7</span> h<span class="hljs-number">-7</span> ml<span class="hljs-number">-6</span> shadow-md rounded-full overflow-hidden cursor-pointer<span class="hljs-string">&quot;</span><br><span class="hljs-string">          &gt;</span><br><span class="hljs-string">            &lt;%= img_tag @current_user.avatar_url,</span><br><span class="hljs-string">            class: &quot;</span>w-full h-full object-cover object-center<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">          &lt;ul class=&quot;</span>absolute top<span class="hljs-number">-14</span> w<span class="hljs-number">-56</span> bg-white shadow-md text-sm -right<span class="hljs-number">-8</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">              x-show=&quot;</span>open<span class="hljs-string">&quot;</span><br><span class="hljs-string">              @click.away=&quot;</span>open = <span class="hljs-keyword">false</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">              x-transition:enter=&quot;</span>transition ease-out duration<span class="hljs-number">-200</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">              x-transition:enter-start=&quot;</span>opacity-0 transform scale<span class="hljs-number">-90</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">              x-transition:enter-end=&quot;</span>opacity<span class="hljs-number">-100</span> transform scale<span class="hljs-number">-100</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">              x-transition:leave=&quot;</span>transition ease-<span class="hljs-keyword">in</span> duration<span class="hljs-number">-200</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">              x-transition:leave-start=&quot;</span>opacity<span class="hljs-number">-100</span> transform scale<span class="hljs-number">-100</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">              x-transition:leave-end=&quot;</span>opacity-0 transform scale<span class="hljs-number">-90</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">            &gt;</span><br><span class="hljs-string">              &lt;%= live_patch to: &quot;</span><span class="hljs-string">&quot; do %&gt;</span><br><span class="hljs-string">                &lt;li class=&quot;</span>py<span class="hljs-number">-2</span> px<span class="hljs-number">-4</span> <span class="hljs-symbol">hover:</span>bg-gray<span class="hljs-number">-50</span><span class="hljs-string">&quot;&gt;Profile&lt;/li&gt;</span><br><span class="hljs-string">              &lt;% end %&gt;</span><br><span class="hljs-string">              &lt;li class=&quot;</span>py<span class="hljs-number">-2</span> px<span class="hljs-number">-4</span> <span class="hljs-symbol">hover:</span>bg-gray<span class="hljs-number">-50</span><span class="hljs-string">&quot;&gt;Saved&lt;/li&gt;</span><br><span class="hljs-string">              &lt;%= live_patch to: &quot;</span><span class="hljs-string">&quot; do %&gt;</span><br><span class="hljs-string">                &lt;li class=&quot;</span>py<span class="hljs-number">-2</span> px<span class="hljs-number">-4</span> <span class="hljs-symbol">hover:</span>bg-gray<span class="hljs-number">-50</span><span class="hljs-string">&quot;&gt;Settings&lt;/li&gt;</span><br><span class="hljs-string">              &lt;% end %&gt;</span><br><span class="hljs-string">              &lt;li class=&quot;</span>border-t<span class="hljs-number">-2</span> py<span class="hljs-number">-2</span> px<span class="hljs-number">-4</span> <span class="hljs-symbol">hover:</span>bg-gray<span class="hljs-number">-50</span><span class="hljs-string">&quot;&gt;&lt;%= link &quot;</span>Log Out<span class="hljs-string">&quot;, to: Routes.user_session_path(@socket, :delete), method: :delete %&gt;&lt;/li&gt;</span><br><span class="hljs-string">            &lt;/ul&gt;</span><br><span class="hljs-string">        &lt;% else %&gt;</span><br><span class="hljs-string">          &lt;li&gt;</span><br><span class="hljs-string">            &lt;%= link &quot;</span>Log In<span class="hljs-string">&quot;, to: Routes.user_session_path(@socket, :new), class: &quot;</span><span class="hljs-symbol">md:</span>w<span class="hljs-number">-24</span> py<span class="hljs-number">-1</span> px<span class="hljs-number">-3</span> border-none shadow rounded text-gray<span class="hljs-number">-50</span> <span class="hljs-symbol">hover:</span>bg-blue<span class="hljs-number">-600</span> bg-blue<span class="hljs-number">-500</span> font-semibold<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">          &lt;li&gt;</span><br><span class="hljs-string">            &lt;%= link &quot;</span>Sign Up<span class="hljs-string">&quot;, to: Routes.user_registration_path(@socket, :new), class: &quot;</span><span class="hljs-symbol">md:</span>w<span class="hljs-number">-24</span> py<span class="hljs-number">-1</span> px<span class="hljs-number">-3</span> border-none text-blue<span class="hljs-number">-500</span> <span class="hljs-symbol">hover:</span>text-blue<span class="hljs-number">-600</span> font-semibold<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">          &lt;/li&gt;</span><br><span class="hljs-string">        &lt;% end %&gt;</span><br><span class="hljs-string">      &lt;/ul&gt;</span><br><span class="hljs-string">    &lt;/nav&gt;</span><br><span class="hljs-string">  &lt;/header&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br></code></pre></td></tr></table></figure>

<p>现在要显示该组件，请打开<code>lib/instagram_clone_web/templates/layout/live.html.leex</code>并将其添加到文件顶部：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;%= if <span class="hljs-variable">@current_user</span> <span class="hljs-keyword">do</span> %&gt;<br>  &lt;%= live_component <span class="hljs-variable">@socket</span>, InstagramCloneWeb.HeaderNavComponent, <span class="hljs-symbol">current_user:</span> <span class="hljs-variable">@current_user</span> %&gt;<br>&lt;% else %&gt;<br>  &lt;%= if <span class="hljs-variable">@current_uri_path</span> !== <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-keyword">do</span> %&gt;<br>    &lt;%= live_component <span class="hljs-variable">@socket</span>, InstagramCloneWeb.HeaderNavComponent, <span class="hljs-symbol">current_user:</span> <span class="hljs-variable">@current_user</span> %&gt;<br>  &lt;% <span class="hljs-keyword">end</span> %&gt;<br>&lt;% <span class="hljs-keyword">end</span> %&gt;<br></code></pre></td></tr></table></figure>

<p>这将检查用户是否已登录以显示标题导航，如果没有，则不是主页，例如我们稍后将创建的个人资料或帖子页面，它也会显示它，否则如果主页且未登录，则不会显示得到显示。</p>
<p>对于第 1 部分来说，这已经足够了，我们还有很长的路要走，还有很多真正令人兴奋和有趣的事情要做，我在撰写本系列文章时正在构建它，因此如果有任何错误或错误，我们会在我们进行过程中得到修复，请在下面的评论中告诉我您的想法，您可以为Instagram 克隆 GitHub 存储库做出贡献。</p>
<p>转自：<a target="_blank" rel="noopener" href="https://elixirprogrammer.com/learn/lets-build-an-instagram-clone-with-the-petal-phoenix-elixir-tailwindcss-alpinejs-liveview-stack/">Elixirprogrammer</a></p>

  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>MarkHoo<br>
        <strong>本文链接：</strong><a href="https://blog.markhoo.com/posts/instagram-phoenix-liveview-p1/" title="https:&#x2F;&#x2F;blog.markhoo.com&#x2F;posts&#x2F;instagram-phoenix-liveview-p1&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.markhoo.com&#x2F;posts&#x2F;instagram-phoenix-liveview-p1&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a> 进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/Elixir/">Elixir</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/AlpineJS/" rel="tag">AlpineJS</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Elixir/" rel="tag">Elixir</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/LiveView/" rel="tag">LiveView</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Phoenix/" rel="tag">Phoenix</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/TailwindCSS/" rel="tag">TailwindCSS</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <div class="valine"></div>
<script src='https://cdn.jsdelivr.net/npm/valine'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'LnljA9jtf29oZKiQMJ6OAWJU-gzGzoHsz',
        appKey: 'wb1Mrzef0b2x540dSrcCcg5y'
    })
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-TailwindCSS-%E5%92%8C-AlpineJS"><span class="toc-number">1.</span> <span class="toc-text">设置 TailwindCSS 和 AlpineJS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-AlpineJS"><span class="toc-number">2.</span> <span class="toc-text">添加 AlpineJS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phx-Gen-Auth"><span class="toc-number">3.</span> <span class="toc-text">Phx.Gen.Auth</span></a></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
     
    <div id="nexmoe-search-space">
        <div class="search-container">
            <div class="search-header">
                <div class="search-input-container">
                    <input class="search-input" type="text" placeholder="搜索" oninput="sinput();">
                </div>
                <a class="search-close" onclick="sclose();">×</a>
            </div>
            <div class="search-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1693393436690"></script>


	<script async src="/js/search.js?v=1693393436690"></script>


<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





</body>

</html>
