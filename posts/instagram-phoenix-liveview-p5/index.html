<!DOCTYPE html>

<html lang="zh-CN">

<head>
    
    <title>使用 Phoenix LiveView 构建 Instagram (5) - 和光同尘|MarkHoo_不积跬步无以至千里，不积小流无以成江海</title>
    <meta charset="UTF-8">
    <meta name="description" content="终日而思,不如须臾之所学也">
    <meta name="keywords" content="和光同尘,MarkHoo,Python,Elixir,Phoenix,SpringBoot,Django,">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="https://media.markhoo.com/image/favicon24.ico" type="image/x-icon" />
    <meta name="description" content="使用PETAL(Phoenix、Elixir、TailwindCSS、AlpineJS、LiveView)技术栈构建一个简化版的Instagram Web应用程序">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Phoenix LiveView 构建 Instagram (5)">
<meta property="og:url" content="https://blog.markhoo.com/posts/instagram-phoenix-liveview-p5/">
<meta property="og:site_name" content="和光同尘|MarkHoo_不积跬步无以至千里，不积小流无以成江海">
<meta property="og:description" content="使用PETAL(Phoenix、Elixir、TailwindCSS、AlpineJS、LiveView)技术栈构建一个简化版的Instagram Web应用程序">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/08/30/UCjWrkeSuIXfFD4.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/08/30/9cRfFlpOXx1tC3I.gif">
<meta property="article:published_time" content="2023-09-02T14:43:40.000Z">
<meta property="article:modified_time" content="2023-08-30T09:17:09.654Z">
<meta property="article:author" content="MarkHoo">
<meta property="article:tag" content="Elixir">
<meta property="article:tag" content="Phoenix">
<meta property="article:tag" content="LiveView">
<meta property="article:tag" content="TailwindCSS">
<meta property="article:tag" content="AlpineJS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/08/30/UCjWrkeSuIXfFD4.jpg">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1693394534816">
     
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1693394534816">
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://s2.loli.net/2023/08/30/SfpNaZsg3IW5MDz.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="MarkHoo" class="mdui-btn mdui-btn-icon"><img src="https://media.markhoo.com/avatar.jpg" alt="MarkHoo"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="MarkHoo">
            <img src="https://media.markhoo.com/avatar.jpg" alt="MarkHoo" alt="MarkHoo">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>53</div>
        <div><span>标签</span>40</div>
        <div><span>分类</span>11</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archives" title="归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/books" title="书架">
            <i class="mdui-list-item-icon nexmoefont icon-battlenet"></i>
            <div class="mdui-list-item-content">
                书架
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about" title="关于">
            <i class="mdui-list-item-icon nexmoefont icon-coffee"></i>
            <div class="mdui-list-item-content">
                关于
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/links" title="邻居">
            <i class="mdui-list-item-icon nexmoefont icon-dribbble"></i>
            <div class="mdui-list-item-content">
                邻居
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://cn.bing.com/search?q=site:markhoo.com" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/182687081" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/markhoo/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/AlpineJS/" style="font-size: 16.25px;">AlpineJS</a> <a href="/tags/ArchLinux/" style="font-size: 10px;">ArchLinux</a> <a href="/tags/C-C/" style="font-size: 10px;">C/C++</a> <a href="/tags/CentOS7/" style="font-size: 15px;">CentOS7</a> <a href="/tags/Django/" style="font-size: 18.75px;">Django</a> <a href="/tags/Elixir/" style="font-size: 18.75px;">Elixir</a> <a href="/tags/EndeavourOS/" style="font-size: 10px;">EndeavourOS</a> <a href="/tags/Erlang/" style="font-size: 10px;">Erlang</a> <a href="/tags/Gin/" style="font-size: 10px;">Gin</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Gitlab/" style="font-size: 10px;">Gitlab</a> <a href="/tags/Go/" style="font-size: 16.25px;">Go</a> <a href="/tags/Gunicorn/" style="font-size: 12.5px;">Gunicorn</a> <a href="/tags/Hugo/" style="font-size: 10px;">Hugo</a> <a href="/tags/IDE/" style="font-size: 11.25px;">IDE</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Linux/" style="font-size: 13.75px;">Linux</a> <a href="/tags/LiveView/" style="font-size: 16.25px;">LiveView</a> <a href="/tags/Lua/" style="font-size: 11.25px;">Lua</a> <a href="/tags/Manim/" style="font-size: 10px;">Manim</a> <a href="/tags/NeoVim/" style="font-size: 11.25px;">NeoVim</a> <a href="/tags/Nginx/" style="font-size: 13.75px;">Nginx</a> <a href="/tags/Phoenix/" style="font-size: 17.5px;">Phoenix</a> <a href="/tags/PyCharm/" style="font-size: 10px;">PyCharm</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/Rest/" style="font-size: 10px;">Rest</a> <a href="/tags/TailwindCSS/" style="font-size: 16.25px;">TailwindCSS</a> <a href="/tags/Unix/" style="font-size: 10px;">Unix</a> <a href="/tags/Vim/" style="font-size: 12.5px;">Vim</a> <a href="/tags/hexo/" style="font-size: 11.25px;">hexo</a> <a href="/tags/pip/" style="font-size: 11.25px;">pip</a> <a href="/tags/pypi/" style="font-size: 10px;">pypi</a> <a href="/tags/xadmin/" style="font-size: 10px;">xadmin</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/" style="font-size: 10px;">网易云音乐</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 11.25px;">面试题</a> <a href="/tags/%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/" style="font-size: 10px;">音乐播放器</a>
    </div>
    
  </div>

    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 MarkHoo
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><a target="_blank" href="https://beian.miit.gov.cn">苏ICP备17044309号</a><br><a target="_blank" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"><img src="https://i.dawnlab.me/c0268c1e6cfd0863d6ba35be1575941a.png" width="150px"></a><script data-ad-client="ca-pub-2058306854838448" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: 45.83333333333333%;"> 
              <img data-src="https://s2.loli.net/2023/08/30/SfpNaZsg3IW5MDz.jpg" data-sizes="auto" alt="使用 Phoenix LiveView 构建 Instagram (5)" class="lazyload">
              <h1>使用 Phoenix LiveView 构建 Instagram (5)</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2023年09月02日</a>
    <a><i class="nexmoefont icon-areachart"></i>5k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 30 分钟</a>
</div>

      

      <blockquote>
<p>使用PETAL(Phoenix、Elixir、TailwindCSS、AlpineJS、LiveView)技术栈构建一个简化版的Instagram Web应用程序</p>
</blockquote>
<span id="more"></span>

<p>在第 4 部分中，我们添加了个人资料帖子部分和帖子页面，在这部分中，我们将处理显示帖子页面。您可以赶上Instagram 克隆 GitHub Repo。</p>
<p>让我们首先为显示页面添加基本模板，打开<code>lib/instagram_clone_web/live/post_live/show.html.leex</code>并添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;section class=<span class="hljs-string">&quot;flex&quot;</span>&gt;<br>  &lt;!-- Post Image section --&gt;<br>  &lt;%= img_tag <span class="hljs-variable">@post</span>.photo_url,<br>          <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-3/5 object-contain h-full&quot;</span> %&gt;<br>  &lt;!-- End Post Image section --&gt;<br><br>  &lt;div class=<span class="hljs-string">&quot;w-2/5 border-2 h-full&quot;</span>&gt;<br>    &lt;div class=<span class="hljs-string">&quot;flex p-4 items-center border-b-2&quot;</span>&gt;<br>      &lt;!-- Post header section --&gt;<br>      &lt;%= live_redirect <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username) <span class="hljs-keyword">do</span> %&gt;<br>        &lt;%= img_tag <span class="hljs-variable">@post</span>.user.avatar_url, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-8 h-8 rounded-full object-cover object-center&quot;</span> %&gt;<br>      &lt;% <span class="hljs-keyword">end</span> %&gt;<br>      &lt;div class=<span class="hljs-string">&quot;ml-3&quot;</span>&gt;<br>        &lt;%= live_redirect <span class="hljs-variable">@post</span>.user.username,<br>          <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username),<br>          <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;truncate font-bold text-sm text-gray-500 hover:underline&quot;</span> %&gt;<br>      &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;!-- End post header section --&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;no-scrollbar h-96 overflow-y-scroll p-4 flex flex-col&quot;</span>&gt;<br>      &lt;%= if <span class="hljs-variable">@post</span>.description <span class="hljs-keyword">do</span> %&gt;<br>        &lt;!-- Description section --&gt;<br>        &lt;div class=<span class="hljs-string">&quot;flex mt-2&quot;</span>&gt;<br>          &lt;%= live_redirect <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username) <span class="hljs-keyword">do</span> %&gt;<br>            &lt;%= img_tag Avatar.get_thumb(<span class="hljs-variable">@post</span>.user.avatar_url), <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-8 h-8 rounded-full object-cover object-center&quot;</span> %&gt;<br>          &lt;% <span class="hljs-keyword">end</span> %&gt;<br><br>          &lt;div class=<span class="hljs-string">&quot;px-4 w-11/12&quot;</span>&gt;<br>            &lt;%= live_redirect <span class="hljs-variable">@post</span>.user.username,<br>            <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username),<br>            <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;font-bold text-sm text-gray-500 hover:underline&quot;</span> %&gt;<br>            &lt;span class=<span class="hljs-string">&quot;text-sm text-gray-700&quot;</span>&gt;<br>              &lt;p class=<span class="hljs-string">&quot;inline&quot;</span>&gt;&lt;%= <span class="hljs-variable">@post</span>.description %&gt;&lt;<span class="hljs-regexp">/p&gt;&lt;/span</span>&gt;<br>            &lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">            &lt;div class=&quot;flex mt-3&quot;&gt;</span><br><span class="hljs-regexp">              &lt;div class=&quot;text-gray-400 text-xs&quot;&gt;&lt;%= Timex.from_now @post.inserted_at %&gt;&lt;/div</span>&gt;<br>            &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">          &lt;/div</span>&gt;<br><br>        &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;!-- End Description Section --&gt;</span><br><span class="hljs-regexp">      &lt;% end %&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;w-full border-t-2&quot;</span>&gt;<br>      &lt;!-- Action icons section --&gt;<br>      &lt;div class=<span class="hljs-string">&quot;flex pl-4 pr-2 pt-2&quot;</span>&gt;<br>        &lt;div class=<span class="hljs-string">&quot;w-8 h-8 cursor-pointer&quot;</span>&gt;<br>          &lt;svg xmlns=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span> fill=<span class="hljs-string">&quot;none&quot;</span> viewBox=<span class="hljs-string">&quot;0 0 24 24&quot;</span> stroke=<span class="hljs-string">&quot;currentColor&quot;</span>&gt;<br>            &lt;path stroke-linecap=<span class="hljs-string">&quot;round&quot;</span> stroke-linejoin=<span class="hljs-string">&quot;round&quot;</span> stroke-width=<span class="hljs-string">&quot;1&quot;</span> d=<span class="hljs-string">&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot;</span> /&gt;<br>          &lt;<span class="hljs-regexp">/svg&gt;</span><br><span class="hljs-regexp">          &lt;svg class=&quot;hidden text-red-600&quot; xmlns=&quot;http:/</span><span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">20</span> <span class="hljs-number">20</span><span class="hljs-string">&quot; fill=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;path fill-rule=&quot;</span>evenodd<span class="hljs-string">&quot; d=&quot;</span>M3.<span class="hljs-number">172</span> <span class="hljs-number">5.172</span>a4 <span class="hljs-number">4</span> 0 015.<span class="hljs-number">656</span> 0L10 <span class="hljs-number">6.343</span>l1.<span class="hljs-number">172</span><span class="hljs-number">-1.171</span>a4 <span class="hljs-number">4</span> 0 <span class="hljs-number">115.656</span> <span class="hljs-number">5.656</span>L10 <span class="hljs-number">17.657</span>l<span class="hljs-number">-6.828</span><span class="hljs-number">-6.829</span>a4 <span class="hljs-number">4</span> 0 010<span class="hljs-number">-5.656</span>z<span class="hljs-string">&quot; clip-rule=&quot;</span>evenodd<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">          &lt;/svg&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;</span>ml<span class="hljs-number">-4</span> w<span class="hljs-number">-8</span> h<span class="hljs-number">-8</span> cursor-pointer<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M8 <span class="hljs-number">12</span>h.01M12 <span class="hljs-number">12</span>h.01M16 <span class="hljs-number">12</span>h.01M21 <span class="hljs-number">12</span>c0 <span class="hljs-number">4.418</span><span class="hljs-number">-4.03</span> <span class="hljs-number">8</span><span class="hljs-number">-9</span> <span class="hljs-number">8</span>a9.<span class="hljs-number">863</span> <span class="hljs-number">9.863</span> 0 01<span class="hljs-number">-4.255</span>-.<span class="hljs-number">949</span>L3 <span class="hljs-number">20</span>l1.<span class="hljs-number">395</span><span class="hljs-number">-3.72</span>C3.<span class="hljs-number">512</span> <span class="hljs-number">15.042</span> <span class="hljs-number">3</span> <span class="hljs-number">13.574</span> <span class="hljs-number">3</span> <span class="hljs-number">12</span>c0<span class="hljs-number">-4.418</span> <span class="hljs-number">4.03</span><span class="hljs-number">-8</span> <span class="hljs-number">9</span><span class="hljs-number">-8</span>s9 <span class="hljs-number">3.582</span> <span class="hljs-number">9</span> <span class="hljs-number">8</span>z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">          &lt;/svg&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;</span>ml<span class="hljs-number">-4</span> w<span class="hljs-number">-8</span> h<span class="hljs-number">-8</span> cursor-pointer<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M8.<span class="hljs-number">684</span> <span class="hljs-number">13.342</span>C8.<span class="hljs-number">886</span> <span class="hljs-number">12.938</span> <span class="hljs-number">9</span> <span class="hljs-number">12.482</span> <span class="hljs-number">9</span> <span class="hljs-number">12</span>c0-.<span class="hljs-number">482</span>-.<span class="hljs-number">114</span>-.<span class="hljs-number">938</span>-.<span class="hljs-number">316</span><span class="hljs-number">-1.342</span>m0 <span class="hljs-number">2.684</span>a3 <span class="hljs-number">3</span> 0 <span class="hljs-number">110</span><span class="hljs-number">-2.684</span>m0 <span class="hljs-number">2.684</span>l6.<span class="hljs-number">632</span> <span class="hljs-number">3.316</span>m<span class="hljs-number">-6.632</span><span class="hljs-number">-6</span>l6.<span class="hljs-number">632</span><span class="hljs-number">-3.316</span>m0 0a3 <span class="hljs-number">3</span> 0 <span class="hljs-number">105.367</span><span class="hljs-number">-2.684</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> 0 00<span class="hljs-number">-5.367</span> <span class="hljs-number">2.684</span>zm0 <span class="hljs-number">9.316</span>a3 <span class="hljs-number">3</span> 0 <span class="hljs-number">105.368</span> <span class="hljs-number">2.684</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> 0 00<span class="hljs-number">-5.368</span><span class="hljs-number">-2.684</span>z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">          &lt;/svg&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;</span>w<span class="hljs-number">-8</span> h<span class="hljs-number">-8</span> ml-auto cursor-pointer<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M5 <span class="hljs-number">5</span>a2 <span class="hljs-number">2</span> 0 012<span class="hljs-number">-2</span>h10a2 <span class="hljs-number">2</span> 0 012 <span class="hljs-number">2</span>v16l<span class="hljs-number">-7</span><span class="hljs-number">-3.5</span>L5 <span class="hljs-number">21</span>V5z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">          &lt;/svg&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string">      &lt;!-- End Action icons section --&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;!-- Description section --&gt;</span><br><span class="hljs-string">      &lt;button class=&quot;</span>px<span class="hljs-number">-5</span> text-xs text-gray<span class="hljs-number">-500</span> font-bold <span class="hljs-symbol">focus:</span>outline-none<span class="hljs-string">&quot;&gt;&lt;%= @post.total_likes %&gt; likes&lt;/button&gt;</span><br><span class="hljs-string">      &lt;h6 class=&quot;</span>px<span class="hljs-number">-5</span> text-xs text-gray<span class="hljs-number">-400</span><span class="hljs-string">&quot;&gt;&lt;%= Timex.format!(@post.inserted_at, &quot;</span>&#123;Mfull&#125; &#123;D&#125;, &#123;YYYY&#125;<span class="hljs-string">&quot;) %&gt;&lt;/h6&gt;</span><br><span class="hljs-string">      &lt;!-- End Description Section --&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;!-- Comment input section --&gt;</span><br><span class="hljs-string">      &lt;div class=&quot;</span>p<span class="hljs-number">-2</span> flex items-center mt<span class="hljs-number">-3</span> border-t<span class="hljs-number">-2</span> border-gray<span class="hljs-number">-100</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;</span>w-full<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;textarea</span><br><span class="hljs-string">            aria-label=&quot;</span>Add a comment...<span class="hljs-string">&quot;</span><br><span class="hljs-string">            placeholder=&quot;</span>Add a comment...<span class="hljs-string">&quot;</span><br><span class="hljs-string">            class=&quot;</span>w-full border-0 <span class="hljs-symbol">focus:</span>ring-transparent resize-none<span class="hljs-string">&quot;</span><br><span class="hljs-string">            autocomplete=&quot;</span>off<span class="hljs-string">&quot;</span><br><span class="hljs-string">            autocorrect=&quot;</span>off<span class="hljs-string">&quot;</span><br><span class="hljs-string">            rows=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot;&gt;&lt;/textarea&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div&gt;&lt;button class=&quot;</span>text-light-blue<span class="hljs-number">-500</span> font-bold pb<span class="hljs-number">-2</span> text-sm<span class="hljs-string">&quot;&gt;Post&lt;/button&gt;&lt;/div&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string">    &lt;!-- End Comment input section --&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">  &lt;/div&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;/section&gt;</span><br></code></pre></td></tr></table></figure>

<p>打开<code>assets/css/app.scss</code>并将以下样式添加到文件底部，以使页面评论部分不显示滚动条：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elixir">/* Chrome, Safari <span class="hljs-keyword">and</span> Opera *<span class="hljs-regexp">/</span><br><span class="hljs-regexp">.no-scrollbar::-webkit-scrollbar &#123;</span><br><span class="hljs-regexp">  display: none;</span><br><span class="hljs-regexp">&#125;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">.no-scrollbar &#123;</span><br><span class="hljs-regexp">  -ms-overflow-style: none;  /</span>* IE <span class="hljs-keyword">and</span> Edge *<span class="hljs-regexp">/</span><br><span class="hljs-regexp">  scrollbar-width: none;  /</span>* Firefox *<span class="hljs-regexp">/</span><br><span class="hljs-regexp">&#125;</span><br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://s2.loli.net/2023/08/30/UCjWrkeSuIXfFD4.jpg" alt="instagram-phoenix-p5-1.jpg" class="lazyload"></p>
<h2 id="喜欢"><a href="#喜欢" class="headerlink" title="喜欢"></a>喜欢</h2><p>让我们在终端中创建喜欢的上下文：</p>
<p><code>$ mix phx.gen.context Likes Like likes user_id:references:users liked_id:integer</code></p>
<p>在生成的迁移中：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramClone.Repo.Migrations.CreateLikes</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> Ecto.Migration<br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span> <span class="hljs-keyword">do</span><br>    create table(<span class="hljs-symbol">:likes</span>) <span class="hljs-keyword">do</span><br>      add <span class="hljs-symbol">:liked_id</span>, <span class="hljs-symbol">:integer</span><br>      add <span class="hljs-symbol">:user_id</span>, references(<span class="hljs-symbol">:users</span>, <span class="hljs-symbol">on_delete:</span> <span class="hljs-symbol">:nothing</span>)<br><br>      timestamps()<br>    <span class="hljs-keyword">end</span><br><br>    create index(<span class="hljs-symbol">:likes</span>, [<span class="hljs-symbol">:user_id</span>, <span class="hljs-symbol">:liked_id</span>])<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>回到我们的终端：<code>$ mix ecto.migrate</code></p>
<p>里面<code>lib/instagram_clone/likes/like.ex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramClone.Likes.Like</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> Ecto.Schema<br><br>  schema <span class="hljs-string">&quot;posts_likes&quot;</span> <span class="hljs-keyword">do</span><br>    field <span class="hljs-symbol">:liked_id</span>, <span class="hljs-symbol">:integer</span><br>    belongs_to <span class="hljs-symbol">:user</span>, InstagramClone.Accounts.User<br><br>    timestamps()<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>将喜欢关系添加到帖子架构中，打开<code>lib/instagram_clone/posts/post.ex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>...<br><br>has_many <span class="hljs-symbol">:likes</span>, InstagramClone.Likes.Like, <span class="hljs-symbol">foreign_key:</span> <span class="hljs-symbol">:liked_id</span><br><br>...<br></code></pre></td></tr></table></figure>

<p>将喜欢关系添加到用户架构中，打开<code>lib/instagram_clone/accounts/user.ex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>...<br><br>has_many <span class="hljs-symbol">:likes</span>, InstagramClone.Likes.Like<br><br>...<br></code></pre></td></tr></table></figure>

<p>里面<code>lib/instagram_clone/likes.ex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramClone.Likes</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">import</span> Ecto.Query, <span class="hljs-symbol">warn:</span> <span class="hljs-keyword">false</span><br>  <span class="hljs-keyword">alias</span> InstagramClone.Repo<br>  <span class="hljs-keyword">alias</span> InstagramClone.Likes.Like<br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_like</span></span>(user, liked) <span class="hljs-keyword">do</span><br>    user = Ecto.build_assoc(user, <span class="hljs-symbol">:likes</span>)<br>    like = Ecto.build_assoc(liked, <span class="hljs-symbol">:likes</span>, user)<br>    update_total_likes = liked.__struct__ |&gt; where(<span class="hljs-symbol">id:</span> ^liked.id)<br><br>    Ecto.Multi.new()<br>    |&gt; Ecto.Multi.insert(<span class="hljs-symbol">:like</span>, like)<br>    |&gt; Ecto.Multi.update_all(<span class="hljs-symbol">:update_total_likes</span>, update_total_likes, <span class="hljs-symbol">inc:</span> [<span class="hljs-symbol">total_likes:</span> <span class="hljs-number">1</span>])<br>    |&gt; Repo.transaction()<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unlike</span></span>(user_id, liked) <span class="hljs-keyword">do</span><br>    like = get_like(user_id, liked)<br>    update_total_likes = liked.__struct__ |&gt; where(<span class="hljs-symbol">id:</span> ^liked.id)<br><br>    Ecto.Multi.new()<br>    |&gt; Ecto.Multi.delete(<span class="hljs-symbol">:like</span>, like)<br>    |&gt; Ecto.Multi.update_all(<span class="hljs-symbol">:update_total_likes</span>, update_total_likes, <span class="hljs-symbol">inc:</span> [<span class="hljs-symbol">total_likes:</span> <span class="hljs-number">-1</span>])<br>    |&gt; Repo.transaction()<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-comment"># Returns nil if not found</span><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">get_like</span></span>(user_id, liked) <span class="hljs-keyword">do</span><br>    Enum.find(liked.likes, <span class="hljs-keyword">fn</span> l -&gt;<br>      l.user_id == user_id<br>    <span class="hljs-keyword">end</span>)<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>让我们创建一个组件来处理点赞，在下面<code>lib/instagram_clone_web/live/post_live</code>添加一个名为的文件<code>like_component.ex</code>并添加以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramCloneWeb.PostLive.LikeComponent</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> InstagramCloneWeb, <span class="hljs-symbol">:live_component</span><br><br>  <span class="hljs-keyword">alias</span> InstagramClone.Likes<br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span></span>(assigns, socket) <span class="hljs-keyword">do</span><br>    get_btn_status(socket, assigns)<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">render</span></span>(assigns) <span class="hljs-keyword">do</span><br>    <span class="hljs-string">~L&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;button</span><br><span class="hljs-string">      phx-target=&quot;&lt;%= @myself %&gt;&quot;</span><br><span class="hljs-string">      phx-click=&quot;</span>toggle-status<span class="hljs-string">&quot;</span><br><span class="hljs-string">      class=&quot;</span>&lt;%= <span class="hljs-variable">@w_h</span> %&gt; <span class="hljs-symbol">focus:</span>outline-none<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;%= @icon %&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &lt;/button&gt;</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_event</span></span>(<span class="hljs-string">&quot;toggle-status&quot;</span>, _params, socket) <span class="hljs-keyword">do</span><br>    current_user = socket.assigns.current_user<br>    liked = socket.assigns.liked<br><br>    if liked?(current_user.id, liked.likes) <span class="hljs-keyword">do</span><br>      unlike(socket, current_user.id, liked)<br>    else<br>      like(socket, current_user, liked)<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">like</span></span>(socket, current_user, liked) <span class="hljs-keyword">do</span><br>    Likes.create_like(current_user, liked)<br>    send_msg(liked)<br><br>    &#123;<span class="hljs-symbol">:noreply</span>,<br>      socket<br>      |&gt; assign(<span class="hljs-symbol">icon:</span> unlike_icon(socket.assigns))&#125;<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">unlike</span></span>(socket, current_user_id, liked) <span class="hljs-keyword">do</span><br>    Likes.unlike(current_user_id, liked)<br>    send_msg(liked)<br><br>    &#123;<span class="hljs-symbol">:noreply</span>,<br>      socket<br>      |&gt; assign(<span class="hljs-symbol">icon:</span> like_icon(socket.assigns))&#125;<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">send_msg</span></span>(liked) <span class="hljs-keyword">do</span><br>    msg = get_struct_msg_atom(liked)<br>    send(<span class="hljs-keyword">self</span>(), &#123;__MODULE__, msg, liked.id&#125;)<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">get_btn_status</span></span>(socket, assigns) <span class="hljs-keyword">do</span><br>    if liked?(assigns.current_user.id, assigns.liked.likes) <span class="hljs-keyword">do</span><br>      get_socket_assigns(socket, assigns, unlike_icon(assigns))<br>    else<br>      get_socket_assigns(socket, assigns, like_icon(assigns))<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">get_socket_assigns</span></span>(socket, assigns, icon) <span class="hljs-keyword">do</span><br>    &#123;<span class="hljs-symbol">:ok</span>,<br>      socket<br>      |&gt; assign(assigns)<br>      |&gt; assign(<span class="hljs-symbol">icon:</span> icon)&#125;<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">get_struct_name</span></span>(struct) <span class="hljs-keyword">do</span><br>    struct.__struct__<br>    |&gt; Module.split()<br>    |&gt; List.last()<br>    |&gt; String.downcase()<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">get_struct_msg_atom</span></span>(struct) <span class="hljs-keyword">do</span><br>    name = get_struct_name(struct)<br>    update_struct_likes = <span class="hljs-string">&quot;update_<span class="hljs-subst">#&#123;name&#125;</span>_likes&quot;</span><br>    String.to_atom(update_struct_likes)<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">like_icon</span></span>(assigns) <span class="hljs-keyword">do</span><br>    <span class="hljs-string">~L&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">      &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M4.<span class="hljs-number">318</span> <span class="hljs-number">6.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 000 <span class="hljs-number">6.364</span>L12 <span class="hljs-number">20.364</span>l7.<span class="hljs-number">682</span><span class="hljs-number">-7.682</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span><span class="hljs-number">-6.364</span>L12 <span class="hljs-number">7.636</span>l<span class="hljs-number">-1.318</span><span class="hljs-number">-1.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span> 0z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">    &lt;/svg&gt;</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">unlike_icon</span></span>(assigns) <span class="hljs-keyword">do</span><br>    <span class="hljs-string">~L&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;svg class=&quot;</span>text-red<span class="hljs-number">-600</span><span class="hljs-string">&quot; xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">20</span> <span class="hljs-number">20</span><span class="hljs-string">&quot; fill=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">      &lt;path fill-rule=&quot;</span>evenodd<span class="hljs-string">&quot; d=&quot;</span>M3.<span class="hljs-number">172</span> <span class="hljs-number">5.172</span>a4 <span class="hljs-number">4</span> 0 015.<span class="hljs-number">656</span> 0L10 <span class="hljs-number">6.343</span>l1.<span class="hljs-number">172</span><span class="hljs-number">-1.171</span>a4 <span class="hljs-number">4</span> 0 <span class="hljs-number">115.656</span> <span class="hljs-number">5.656</span>L10 <span class="hljs-number">17.657</span>l<span class="hljs-number">-6.828</span><span class="hljs-number">-6.829</span>a4 <span class="hljs-number">4</span> 0 010<span class="hljs-number">-5.656</span>z<span class="hljs-string">&quot; clip-rule=&quot;</span>evenodd<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">    &lt;/svg&gt;</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-keyword">end</span><br>  <br>  <span class="hljs-comment"># Returns true if id found in list</span><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">liked?</span></span>(user_id, likes) <span class="hljs-keyword">do</span><br>    Enum.any?(likes, <span class="hljs-keyword">fn</span> l -&gt;<br>      l.user_id == user_id<br>    <span class="hljs-keyword">end</span>)<br>  <span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>在第 50 行内<code>lib/instagram_clone_web/live/post_live/show.html.leex</code>，将包含心形图标的 div 替换为以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>...<br><br>        &lt;%= if <span class="hljs-variable">@current_user</span> <span class="hljs-keyword">do</span> %&gt;<br>          &lt;%= live_component <span class="hljs-variable">@socket</span>,<br>              InstagramCloneWeb.PostLive.LikeComponent,<br>              <span class="hljs-symbol">id:</span> <span class="hljs-variable">@post</span>.id,<br>              <span class="hljs-symbol">liked:</span> <span class="hljs-variable">@post</span>,<br>              <span class="hljs-symbol">w_h:</span> <span class="hljs-string">&quot;w-8 h-8&quot;</span>,<br>              <span class="hljs-symbol">current_user:</span> <span class="hljs-variable">@current_user</span> %&gt;<br>        &lt;% else %&gt;<br>          &lt;%= link <span class="hljs-symbol">to:</span> Routes.user_session_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:new</span>) <span class="hljs-keyword">do</span> %&gt;<br>            &lt;button class=<span class="hljs-string">&quot;w-8 h-8 focus:outline-none&quot;</span>&gt;<br>              &lt;svg xmlns=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span> fill=<span class="hljs-string">&quot;none&quot;</span> viewBox=<span class="hljs-string">&quot;0 0 24 24&quot;</span> stroke=<span class="hljs-string">&quot;currentColor&quot;</span>&gt;<br>                &lt;path stroke-linecap=<span class="hljs-string">&quot;round&quot;</span> stroke-linejoin=<span class="hljs-string">&quot;round&quot;</span> stroke-width=<span class="hljs-string">&quot;1&quot;</span> d=<span class="hljs-string">&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot;</span> /&gt;<br>              &lt;<span class="hljs-regexp">/svg&gt;</span><br><span class="hljs-regexp">            &lt;/button</span>&gt;<br>          &lt;% <span class="hljs-keyword">end</span> %&gt;<br>        &lt;% <span class="hljs-keyword">end</span> %&gt;<br>        <br>...     <br><br>   <br></code></pre></td></tr></table></figure>

<p>在内部<code>lib/instagram_clone_web/live/post_live/show.ex</code>我们需要处理从组件发送的消息以更新喜欢计数：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs elixir">...<br><br>  <span class="hljs-keyword">alias</span> InstagramCloneWeb.PostLive.LikeComponent<br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_info</span></span>(&#123;LikeComponent, <span class="hljs-symbol">:update_post_likes</span>, post_id&#125;, socket) <span class="hljs-keyword">do</span><br>    &#123;<span class="hljs-symbol">:noreply</span>, <br>      socket <br>      |&gt; assign(<span class="hljs-symbol">post:</span> Posts.get_post!(post_id))&#125;<br>  <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>打开并<code>lib/instagram_clone/posts.ex</code>更新函数来预加载belongs_to等用户：<code>get_post!()</code> <code>get_post_by_url()</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>...<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_post!</span></span>(id) <span class="hljs-keyword">do</span><br>    Repo.get!(Post, id)<br>    |&gt; Repo.preload([<span class="hljs-symbol">:user</span>, <span class="hljs-symbol">:likes</span>])<br>  <span class="hljs-keyword">end</span><br>  <br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_post_by_url!</span></span>(id) <span class="hljs-keyword">do</span><br>    Repo.get_by!(Post, <span class="hljs-symbol">url_id:</span> id)<br>    |&gt; Repo.preload([<span class="hljs-symbol">:user</span>, <span class="hljs-symbol">:likes</span>])<br>  <span class="hljs-keyword">end</span><br><br>...<br></code></pre></td></tr></table></figure>

<h2 id="发表评论"><a href="#发表评论" class="headerlink" title="发表评论"></a>发表评论</h2><p>让我们为评论创建一个评论上下文，在终端中输入以下命令：</p>
<p><code>$ mix phx.gen.context Comments Comment comments post_id:references:posts user_id:references:users body:text total_likes:integer</code></p>
<p>在生成的迁移中：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramClone.Repo.Migrations.CreateComments</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> Ecto.Migration<br><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span></span> <span class="hljs-keyword">do</span><br>    create table(<span class="hljs-symbol">:comments</span>) <span class="hljs-keyword">do</span><br>      add <span class="hljs-symbol">:body</span>, <span class="hljs-symbol">:text</span><br>      add <span class="hljs-symbol">:total_likes</span>, <span class="hljs-symbol">:integer</span>, <span class="hljs-symbol">default:</span> 0<br>      add <span class="hljs-symbol">:post_id</span>, references(<span class="hljs-symbol">:posts</span>, <span class="hljs-symbol">on_delete:</span> <span class="hljs-symbol">:nothing</span>)<br>      add <span class="hljs-symbol">:user_id</span>, references(<span class="hljs-symbol">:users</span>, <span class="hljs-symbol">on_delete:</span> <span class="hljs-symbol">:nothing</span>)<br><br>      timestamps()<br>    <span class="hljs-keyword">end</span><br><br>    create index(<span class="hljs-symbol">:comments</span>, [<span class="hljs-symbol">:post_id</span>])<br>    create index(<span class="hljs-symbol">:comments</span>, [<span class="hljs-symbol">:user_id</span>])<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>回到我们的终端：<code>$ mix ecto.migrate</code></p>
<p>里面<code>lib/instagram_clone/comments/comment.ex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramClone.Comments.Comment</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> Ecto.Schema<br>  <span class="hljs-keyword">import</span> Ecto.Changeset<br><br>  schema <span class="hljs-string">&quot;comments&quot;</span> <span class="hljs-keyword">do</span><br>    field <span class="hljs-symbol">:body</span>, <span class="hljs-symbol">:string</span><br>    field <span class="hljs-symbol">:total_likes</span>, <span class="hljs-symbol">:integer</span>, <span class="hljs-symbol">default:</span> 0<br>    belongs_to <span class="hljs-symbol">:post</span>, InstagramClone.Posts.Post<br>    belongs_to <span class="hljs-symbol">:user</span>, InstagramClone.Accounts.User<br>    has_many <span class="hljs-symbol">:likes</span>, InstagramClone.Likes.Like, <span class="hljs-symbol">foreign_key:</span> <span class="hljs-symbol">:liked_id</span><br><br>    timestamps()<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@doc</span> <span class="hljs-keyword">false</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">changeset</span></span>(comment, attrs) <span class="hljs-keyword">do</span><br>    comment<br>    |&gt; cast(attrs, [<span class="hljs-symbol">:body</span>])<br>    |&gt; validate_required([<span class="hljs-symbol">:body</span>])<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p><code>lib/instagram_clone/accounts/user.ex</code>在和内添加以下内容<code>lib/instagram_clone/posts/post.ex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>...<br>  <br>  has_many <span class="hljs-symbol">:comments</span>, InstagramClone.Comments.Comment<br><br>...<br></code></pre></td></tr></table></figure>

<p>里面<code>lib/instagram_clone/comments.ex</code>添加以下函数：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>...<br>  <span class="hljs-variable">@doc</span>  <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">  Returns paginated comments sorted by current user id or by id if public</span><br><span class="hljs-string">  &quot;&quot;&quot;</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">list_post_comments</span></span>(assigns, <span class="hljs-symbol">public:</span> public) <span class="hljs-keyword">do</span><br>    user = assigns.current_user<br>    post_id = assigns.post.id<br>    per_page = assigns.per_page<br>    page = assigns.page<br><br>    Comment<br>    |&gt; where(<span class="hljs-symbol">post_id:</span> ^post_id)<br>    |&gt; get_post_comments_sorting(public, user)<br>    |&gt; limit(^per_page)<br>    |&gt; offset(^((page - <span class="hljs-number">1</span>) * per_page))<br>    |&gt; preload([<span class="hljs-symbol">:user</span>, <span class="hljs-symbol">:likes</span>])<br>    |&gt; Repo.all<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">get_post_comments_sorting</span></span>(<span class="hljs-keyword">module</span>, public, user) <span class="hljs-keyword">do</span><br>    if public <span class="hljs-keyword">do</span><br>      order_by(<span class="hljs-keyword">module</span>, <span class="hljs-symbol">asc:</span> <span class="hljs-symbol">:id</span>)<br>    else<br>      order_by(<span class="hljs-keyword">module</span>, fragment(<span class="hljs-string">&quot;(CASE WHEN user_id = ? then 1 else 2 end)&quot;</span>, ^user.id))<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@doc</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">  Gets a single comment.</span><br><span class="hljs-string"></span><br><span class="hljs-string">  Raises `Ecto.NoResultsError` if the Comment does not exist.</span><br><span class="hljs-string"></span><br><span class="hljs-string">  ## Examples</span><br><span class="hljs-string"></span><br><span class="hljs-string">      iex&gt; get_comment!(123)</span><br><span class="hljs-string">      %Comment&#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      iex&gt; get_comment!(456)</span><br><span class="hljs-string">      ** (Ecto.NoResultsError)</span><br><span class="hljs-string"></span><br><span class="hljs-string">  &quot;&quot;&quot;</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_comment!</span></span>(id) <span class="hljs-keyword">do</span><br>    Repo.get!(Comment, id)<br>    |&gt; Repo.preload([<span class="hljs-symbol">:user</span>, <span class="hljs-symbol">:likes</span>])<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@doc</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">  Creates a comment and updates total comments count in post</span><br><span class="hljs-string">  Returns the comment created with likes preloaded</span><br><span class="hljs-string">  &quot;&quot;&quot;</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_comment</span></span>(user, post, attrs \\ %&#123;&#125;) <span class="hljs-keyword">do</span><br>    update_total_comments = post.__struct__ |&gt; where(<span class="hljs-symbol">id:</span> ^post.id)<br>    comment_attrs = %Comment&#123;&#125; |&gt; Comment.changeset(attrs)<br>    comment =<br>      comment_attrs<br>      |&gt; Ecto.Changeset.put_assoc(<span class="hljs-symbol">:user</span>, user)<br>      |&gt; Ecto.Changeset.put_assoc(<span class="hljs-symbol">:post</span>, post)<br><br>    Ecto.Multi.new()<br>    |&gt; Ecto.Multi.update_all(<span class="hljs-symbol">:update_total_comments</span>, update_total_comments, <span class="hljs-symbol">inc:</span> [<span class="hljs-symbol">total_comments:</span> <span class="hljs-number">1</span>])<br>    |&gt; Ecto.Multi.insert(<span class="hljs-symbol">:comment</span>, comment)<br>    |&gt; Repo.transaction()<br>    |&gt; <span class="hljs-keyword">case</span> <span class="hljs-keyword">do</span><br>      &#123;<span class="hljs-symbol">:ok</span>, %&#123;<span class="hljs-symbol">comment:</span> comment&#125;&#125; -&gt;<br>        comment |&gt; Repo.preload(<span class="hljs-symbol">:likes</span>)<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>...<br></code></pre></td></tr></table></figure>

<p>让我们更新<code>lib/instagram_clone_web/live/post_live/show.ex</code>以下内容：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramCloneWeb.PostLive.Show</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> InstagramCloneWeb, <span class="hljs-symbol">:live_view</span><br><br>  <span class="hljs-keyword">alias</span> InstagramClone.Posts<br>  <span class="hljs-keyword">alias</span> InstagramClone.Uploaders.Avatar<br>  <span class="hljs-keyword">alias</span> InstagramCloneWeb.PostLive.LikeComponent<br>  <span class="hljs-keyword">alias</span> InstagramClone.Comments<br>  <span class="hljs-keyword">alias</span> InstagramClone.Comments.Comment<br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mount</span></span>(%&#123;<span class="hljs-string">&quot;id&quot;</span> =&gt; id&#125;, session, socket) <span class="hljs-keyword">do</span><br>    socket = assign_defaults(session, socket)<br>    post = Posts.get_post_by_url!(URI.decode(id))<br><br>    &#123;<span class="hljs-symbol">:ok</span>,<br>      socket<br>      |&gt; assign(<span class="hljs-symbol">changeset:</span> Comments.change_comment(%Comment&#123;&#125;))<br>      |&gt; assign(<span class="hljs-symbol">comments_section_update:</span> <span class="hljs-string">&quot;prepend&quot;</span>)<br>      |&gt; assign(<span class="hljs-symbol">post:</span> post)<br>      |&gt; assign(<span class="hljs-symbol">page:</span> <span class="hljs-number">1</span>, <span class="hljs-symbol">per_page:</span> <span class="hljs-number">15</span>)<br>      |&gt; assign_comments()<br>      |&gt; set_load_more_comments_btn(),<br>      <span class="hljs-symbol">temporary_assigns:</span> [<span class="hljs-symbol">comments:</span> []]&#125;<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">assign_comments</span></span>(socket) <span class="hljs-keyword">do</span><br>    current_user = socket.assigns.current_user<br><br>    if current_user <span class="hljs-keyword">do</span><br>      comments = Comments.list_post_comments(socket.assigns, <span class="hljs-symbol">public:</span> <span class="hljs-keyword">false</span>)<br>      socket |&gt; assign(<span class="hljs-symbol">comments:</span> comments)<br>    else<br>      comments = Comments.list_post_comments(socket.assigns, <span class="hljs-symbol">public:</span> <span class="hljs-keyword">true</span>)<br>      socket |&gt; assign(<span class="hljs-symbol">comments:</span> comments)<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">set_load_more_comments_btn</span></span>(socket) <span class="hljs-keyword">do</span><br>    post_total_comments = socket.assigns.post.total_comments<br>    per_page = socket.assigns.per_page<br><br>    if post_total_comments &gt; per_page <span class="hljs-keyword">do</span><br>      socket |&gt; assign(<span class="hljs-symbol">load_more_comments_btn:</span> <span class="hljs-string">&quot;flex&quot;</span>)<br>    else<br>      socket |&gt; assign(<span class="hljs-symbol">load_more_comments_btn:</span> <span class="hljs-string">&quot;hidden&quot;</span>)<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_info</span></span>(&#123;LikeComponent, <span class="hljs-symbol">:update_comment_likes</span>, comment_id&#125;, socket) <span class="hljs-keyword">do</span><br>    comment = Comments.get_comment!(comment_id)<br>    &#123;<span class="hljs-symbol">:noreply</span>,<br>      socket<br>      |&gt; update(<span class="hljs-symbol">:comments</span>, <span class="hljs-keyword">fn</span> comments -&gt; [comment | comments] <span class="hljs-keyword">end</span>)&#125;<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_info</span></span>(&#123;LikeComponent, <span class="hljs-symbol">:update_post_likes</span>, post_id&#125;, socket) <span class="hljs-keyword">do</span><br>    &#123;<span class="hljs-symbol">:noreply</span>,<br>      socket<br>      |&gt; assign(<span class="hljs-symbol">post:</span> Posts.get_post!(post_id))&#125;<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_event</span></span>(<span class="hljs-string">&quot;load-more-comments&quot;</span>, _, socket) <span class="hljs-keyword">do</span><br>    &#123;<span class="hljs-symbol">:noreply</span>,<br>      socket<br>      |&gt; assign(<span class="hljs-symbol">comments_section_update:</span> <span class="hljs-string">&quot;append&quot;</span>)<br>      |&gt; load_comments()&#125;<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-variable">@impl</span> <span class="hljs-keyword">true</span><br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_event</span></span>(<span class="hljs-string">&quot;save&quot;</span>, %&#123;<span class="hljs-string">&quot;comment&quot;</span> =&gt; comment_param&#125;, socket) <span class="hljs-keyword">do</span><br>    %&#123;<span class="hljs-string">&quot;body&quot;</span> =&gt; body&#125; = comment_param<br>    current_user = socket.assigns.current_user<br>    post = socket.assigns.post<br><br>    if body == <span class="hljs-string">&quot;&quot;</span> <span class="hljs-keyword">do</span><br>      &#123;<span class="hljs-symbol">:noreply</span>, socket&#125;<br>    else<br>      comment = Comments.create_comment(current_user, post, comment_param)<br>      &#123;<span class="hljs-symbol">:noreply</span>,<br>        socket<br>        |&gt; update(<span class="hljs-symbol">:comments</span>, <span class="hljs-keyword">fn</span> comments -&gt; [comment | comments] <span class="hljs-keyword">end</span>)<br>        |&gt; assign(<span class="hljs-symbol">comments_section_update:</span> <span class="hljs-string">&quot;prepend&quot;</span>)<br>        |&gt; assign(<span class="hljs-symbol">changeset:</span> Comments.change_comment(%Comment&#123;&#125;))&#125;<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">load_comments</span></span>(socket) <span class="hljs-keyword">do</span><br>    total_comments = socket.assigns.post.total_comments<br>    page = socket.assigns.page<br>    per_page = socket.assigns.per_page<br>    total_pages = ceil(total_comments / per_page)<br><br>    socket<br>    |&gt; hide_btn?(page, total_pages)<br>    |&gt; update(<span class="hljs-symbol">:page</span>, &amp;(&amp;<span class="hljs-number">1</span> + <span class="hljs-number">1</span>))<br>    |&gt; assign_comments()<br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-function"><span class="hljs-keyword">defp</span> <span class="hljs-title">hide_btn?</span></span>(socket, page, total_pages) <span class="hljs-keyword">do</span><br>    if (page + <span class="hljs-number">1</span>) == total_pages <span class="hljs-keyword">do</span><br>      socket |&gt; assign(<span class="hljs-symbol">load_more_comments_btn:</span> <span class="hljs-string">&quot;hidden&quot;</span>)<br>    else<br>      socket<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>在下面<code>lib/instagram_clone_web/live/post_live</code>创建评论组件<code>comment_component.ex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">InstagramCloneWeb.PostLive.CommentComponent</span></span> <span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">use</span> InstagramCloneWeb, <span class="hljs-symbol">:live_component</span><br><br>  <span class="hljs-keyword">alias</span> InstagramClone.Uploaders.Avatar<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>下的评论组件模板<code>lib/instagram_clone_web/live/post_live/comment_component.html.leex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;div class=<span class="hljs-string">&quot;flex py-2&quot;</span> id=<span class="hljs-string">&quot;comment-&lt;%= @comment.id %&gt;&quot;</span>&gt;<br>  &lt;div class=<span class="hljs-string">&quot;w-1/12 pt-1&quot;</span>&gt;<br>    &lt;%= live_redirect <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@comment</span>.user.username) <span class="hljs-keyword">do</span> %&gt;<br>      &lt;%= img_tag Avatar.get_thumb(<span class="hljs-variable">@comment</span>.user.avatar_url),<br>        <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-8 h-8 rounded-full object-cover object-center&quot;</span> %&gt;<br>    &lt;% <span class="hljs-keyword">end</span> %&gt;<br>  &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">  &lt;div class=&quot;px-4 w-10/</span><span class="hljs-number">12</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">    &lt;%= live_redirect @comment.user.username,</span><br><span class="hljs-string">          to: Routes.user_profile_path(@socket, :index, @comment.user.username),</span><br><span class="hljs-string">          class: &quot;</span>truncate font-bold text-sm text-gray<span class="hljs-number">-500</span> <span class="hljs-symbol">hover:</span>underline<span class="hljs-string">&quot; %&gt;</span><br><span class="hljs-string">    &lt;span class=&quot;</span>text-sm text-gray<span class="hljs-number">-700</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">      &lt;p class=&quot;</span>inline<span class="hljs-string">&quot;&gt;&lt;%= @comment.body %&gt;&lt;/p&gt;&lt;/span&gt;</span><br><span class="hljs-string">    &lt;/span&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;</span>flex mt<span class="hljs-number">-3</span><span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">      &lt;div class=&quot;</span>text-gray<span class="hljs-number">-400</span> text-xs<span class="hljs-string">&quot;&gt;&lt;%= Timex.from_now @comment.inserted_at %&gt;&lt;/div&gt;</span><br><span class="hljs-string">      &lt;button class=&quot;</span>px<span class="hljs-number">-3</span> text-xs text-gray<span class="hljs-number">-700</span> <span class="hljs-symbol">focus:</span>outline-none<span class="hljs-string">&quot;&gt;&lt;%= @comment.total_likes %&gt; likes&lt;/button&gt;</span><br><span class="hljs-string">      &lt;button class=&quot;</span>text-xs text-gray<span class="hljs-number">-700</span> <span class="hljs-symbol">focus:</span>outline-none<span class="hljs-string">&quot;&gt;Reply&lt;/button&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">  &lt;/div&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  &lt;%= if @current_user do %&gt;</span><br><span class="hljs-string">    &lt;%= live_component @socket,</span><br><span class="hljs-string">        InstagramCloneWeb.PostLive.LikeComponent,</span><br><span class="hljs-string">        id: @comment.id,</span><br><span class="hljs-string">        liked: @comment,</span><br><span class="hljs-string">        w_h: &quot;</span>w<span class="hljs-number">-6</span> h<span class="hljs-number">-6</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">        current_user: @current_user %&gt;</span><br><span class="hljs-string">  &lt;% else %&gt;</span><br><span class="hljs-string">    &lt;%= link to: Routes.user_session_path(@socket, :new) do %&gt;</span><br><span class="hljs-string">      &lt;button class=&quot;</span>w<span class="hljs-number">-6</span> h<span class="hljs-number">-6</span> <span class="hljs-symbol">focus:</span>outline-none<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">        &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M4.<span class="hljs-number">318</span> <span class="hljs-number">6.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 000 <span class="hljs-number">6.364</span>L12 <span class="hljs-number">20.364</span>l7.<span class="hljs-number">682</span><span class="hljs-number">-7.682</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span><span class="hljs-number">-6.364</span>L12 <span class="hljs-number">7.636</span>l<span class="hljs-number">-1.318</span><span class="hljs-number">-1.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span> 0z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">        &lt;/svg&gt;</span><br><span class="hljs-string">      &lt;/button&gt;</span><br><span class="hljs-string">    &lt;% end %&gt;</span><br><span class="hljs-string">  &lt;% end %&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br></code></pre></td></tr></table></figure>

<p>最后更新一下<code>lib/instagram_clone_web/live/post_live/show.html.leex</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&lt;section class=<span class="hljs-string">&quot;flex&quot;</span>&gt;<br>  &lt;!-- Post Image section --&gt;<br>  &lt;%= img_tag <span class="hljs-variable">@post</span>.photo_url,<br>          <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-3/5 object-contain h-full&quot;</span> %&gt;<br>  &lt;!-- End Post Image section --&gt;<br><br>  &lt;div class=<span class="hljs-string">&quot;w-2/5 border-2 h-full&quot;</span>&gt;<br>    &lt;div class=<span class="hljs-string">&quot;flex p-4 items-center border-b-2&quot;</span>&gt;<br>      &lt;!-- Post header section --&gt;<br>      &lt;%= live_redirect <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username) <span class="hljs-keyword">do</span> %&gt;<br>        &lt;%= img_tag <span class="hljs-variable">@post</span>.user.avatar_url, <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-8 h-8 rounded-full object-cover object-center&quot;</span> %&gt;<br>      &lt;% <span class="hljs-keyword">end</span> %&gt;<br>      &lt;div class=<span class="hljs-string">&quot;ml-3&quot;</span>&gt;<br>        &lt;%= live_redirect <span class="hljs-variable">@post</span>.user.username,<br>          <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username),<br>          <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;truncate font-bold text-sm text-gray-500 hover:underline&quot;</span> %&gt;<br>      &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;!-- End post header section --&gt;</span><br><span class="hljs-regexp">    &lt;/div</span>&gt;<br><br>    &lt;div class=<span class="hljs-string">&quot;no-scrollbar h-96 overflow-y-scroll p-4 flex flex-col&quot;</span>&gt;<br>      &lt;%= if <span class="hljs-variable">@post</span>.description <span class="hljs-keyword">do</span> %&gt;<br>        &lt;!-- Description section --&gt;<br>        &lt;div class=<span class="hljs-string">&quot;flex mt-2&quot;</span>&gt;<br>          &lt;%= live_redirect <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username) <span class="hljs-keyword">do</span> %&gt;<br>            &lt;%= img_tag Avatar.get_thumb(<span class="hljs-variable">@post</span>.user.avatar_url), <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-8 h-8 rounded-full object-cover object-center&quot;</span> %&gt;<br>          &lt;% <span class="hljs-keyword">end</span> %&gt;<br><br>          &lt;div class=<span class="hljs-string">&quot;px-4 w-11/12&quot;</span>&gt;<br>            &lt;%= live_redirect <span class="hljs-variable">@post</span>.user.username,<br>            <span class="hljs-symbol">to:</span> Routes.user_profile_path(<span class="hljs-variable">@socket</span>, <span class="hljs-symbol">:index</span>, <span class="hljs-variable">@post</span>.user.username),<br>            <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;font-bold text-sm text-gray-500 hover:underline&quot;</span> %&gt;<br>            &lt;span class=<span class="hljs-string">&quot;text-sm text-gray-700&quot;</span>&gt;<br>              &lt;p class=<span class="hljs-string">&quot;inline&quot;</span>&gt;&lt;%= <span class="hljs-variable">@post</span>.description %&gt;&lt;<span class="hljs-regexp">/p&gt;&lt;/span</span>&gt;<br>            &lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">            &lt;div class=&quot;flex mt-3&quot;&gt;</span><br><span class="hljs-regexp">              &lt;div class=&quot;text-gray-400 text-xs&quot;&gt;&lt;%= Timex.from_now @post.inserted_at %&gt;&lt;/div</span>&gt;<br>            &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">          &lt;/div</span>&gt;<br><br>        &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;!-- End Description Section --&gt;</span><br><span class="hljs-regexp">      &lt;% end %&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">      &lt;section id=&quot;comments&quot; phx-update=&quot;&lt;%= @comments_section_update %&gt;&quot;&gt;</span><br><span class="hljs-regexp">        &lt;%= for comment &lt;- @comments do %&gt;</span><br><span class="hljs-regexp">          &lt;%= live_component @socket,</span><br><span class="hljs-regexp">            InstagramCloneWeb.PostLive.CommentComponent,</span><br><span class="hljs-regexp">            id: comment.id,</span><br><span class="hljs-regexp">            current_user: @current_user,</span><br><span class="hljs-regexp">            comment: comment %&gt;</span><br><span class="hljs-regexp">        &lt;% end %&gt;</span><br><span class="hljs-regexp">      &lt;/section</span>&gt;<br><br>      &lt;button<br>        class=<span class="hljs-string">&quot;w-full &lt;%= @load_more_comments_btn %&gt; justify-center pt-2 focus:outline-none&quot;</span><br>        phx-click=<span class="hljs-string">&quot;load-more-comments&quot;</span>&gt;<br>        &lt;svg xmlns=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span> class=<span class="hljs-string">&quot;h-7 w-7 text-gray-400&quot;</span> fill=<span class="hljs-string">&quot;none&quot;</span> viewBox=<span class="hljs-string">&quot;0 0 24 24&quot;</span> stroke=<span class="hljs-string">&quot;currentColor&quot;</span>&gt;<br>          &lt;path stroke-linecap=<span class="hljs-string">&quot;round&quot;</span> stroke-linejoin=<span class="hljs-string">&quot;round&quot;</span> stroke-width=<span class="hljs-string">&quot;2&quot;</span> d=<span class="hljs-string">&quot;M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z&quot;</span> /&gt;<br>        &lt;<span class="hljs-regexp">/svg&gt;</span><br><span class="hljs-regexp">      &lt;/button</span>&gt;<br><br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">    &lt;div class=&quot;w-full border-t-2&quot;&gt;</span><br><span class="hljs-regexp">      &lt;!-- Action icons section --&gt;</span><br><span class="hljs-regexp">      &lt;div class=&quot;flex pl-4 pr-2 pt-2&quot;&gt;</span><br><span class="hljs-regexp">        &lt;%= if @current_user do %&gt;</span><br><span class="hljs-regexp">          &lt;%= live_component @socket,</span><br><span class="hljs-regexp">              InstagramCloneWeb.PostLive.LikeComponent,</span><br><span class="hljs-regexp">              id: @post.id,</span><br><span class="hljs-regexp">              liked: @post,</span><br><span class="hljs-regexp">              w_h: &quot;w-8 h-8&quot;,</span><br><span class="hljs-regexp">              current_user: @current_user %&gt;</span><br><span class="hljs-regexp">        &lt;% else %&gt;</span><br><span class="hljs-regexp">          &lt;%= link to: Routes.user_session_path(@socket, :new) do %&gt;</span><br><span class="hljs-regexp">            &lt;button class=&quot;w-8 h-8 focus:outline-none&quot;&gt;</span><br><span class="hljs-regexp">              &lt;svg xmlns=&quot;http:/</span><span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">                &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M4.<span class="hljs-number">318</span> <span class="hljs-number">6.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 000 <span class="hljs-number">6.364</span>L12 <span class="hljs-number">20.364</span>l7.<span class="hljs-number">682</span><span class="hljs-number">-7.682</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span><span class="hljs-number">-6.364</span>L12 <span class="hljs-number">7.636</span>l<span class="hljs-number">-1.318</span><span class="hljs-number">-1.318</span>a4.<span class="hljs-number">5</span> <span class="hljs-number">4.5</span> 0 00<span class="hljs-number">-6.364</span> 0z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">              &lt;/svg&gt;</span><br><span class="hljs-string">            &lt;/button&gt;</span><br><span class="hljs-string">          &lt;% end %&gt;</span><br><span class="hljs-string">        &lt;% end %&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;</span>ml<span class="hljs-number">-4</span> w<span class="hljs-number">-8</span> h<span class="hljs-number">-8</span> cursor-pointer<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M8 <span class="hljs-number">12</span>h.01M12 <span class="hljs-number">12</span>h.01M16 <span class="hljs-number">12</span>h.01M21 <span class="hljs-number">12</span>c0 <span class="hljs-number">4.418</span><span class="hljs-number">-4.03</span> <span class="hljs-number">8</span><span class="hljs-number">-9</span> <span class="hljs-number">8</span>a9.<span class="hljs-number">863</span> <span class="hljs-number">9.863</span> 0 01<span class="hljs-number">-4.255</span>-.<span class="hljs-number">949</span>L3 <span class="hljs-number">20</span>l1.<span class="hljs-number">395</span><span class="hljs-number">-3.72</span>C3.<span class="hljs-number">512</span> <span class="hljs-number">15.042</span> <span class="hljs-number">3</span> <span class="hljs-number">13.574</span> <span class="hljs-number">3</span> <span class="hljs-number">12</span>c0<span class="hljs-number">-4.418</span> <span class="hljs-number">4.03</span><span class="hljs-number">-8</span> <span class="hljs-number">9</span><span class="hljs-number">-8</span>s9 <span class="hljs-number">3.582</span> <span class="hljs-number">9</span> <span class="hljs-number">8</span>z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">          &lt;/svg&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;</span>ml<span class="hljs-number">-4</span> w<span class="hljs-number">-8</span> h<span class="hljs-number">-8</span> cursor-pointer<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M8.<span class="hljs-number">684</span> <span class="hljs-number">13.342</span>C8.<span class="hljs-number">886</span> <span class="hljs-number">12.938</span> <span class="hljs-number">9</span> <span class="hljs-number">12.482</span> <span class="hljs-number">9</span> <span class="hljs-number">12</span>c0-.<span class="hljs-number">482</span>-.<span class="hljs-number">114</span>-.<span class="hljs-number">938</span>-.<span class="hljs-number">316</span><span class="hljs-number">-1.342</span>m0 <span class="hljs-number">2.684</span>a3 <span class="hljs-number">3</span> 0 <span class="hljs-number">110</span><span class="hljs-number">-2.684</span>m0 <span class="hljs-number">2.684</span>l6.<span class="hljs-number">632</span> <span class="hljs-number">3.316</span>m<span class="hljs-number">-6.632</span><span class="hljs-number">-6</span>l6.<span class="hljs-number">632</span><span class="hljs-number">-3.316</span>m0 0a3 <span class="hljs-number">3</span> 0 <span class="hljs-number">105.367</span><span class="hljs-number">-2.684</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> 0 00<span class="hljs-number">-5.367</span> <span class="hljs-number">2.684</span>zm0 <span class="hljs-number">9.316</span>a3 <span class="hljs-number">3</span> 0 <span class="hljs-number">105.368</span> <span class="hljs-number">2.684</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> 0 00<span class="hljs-number">-5.368</span><span class="hljs-number">-2.684</span>z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">          &lt;/svg&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;</span>w<span class="hljs-number">-8</span> h<span class="hljs-number">-8</span> ml-auto cursor-pointer<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">          &lt;svg xmlns=&quot;</span><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/www.w3.org/</span><span class="hljs-number">2000</span>/svg<span class="hljs-string">&quot; fill=&quot;</span>none<span class="hljs-string">&quot; viewBox=&quot;</span>0 0 <span class="hljs-number">24</span> <span class="hljs-number">24</span><span class="hljs-string">&quot; stroke=&quot;</span>currentColor<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">            &lt;path stroke-linecap=&quot;</span>round<span class="hljs-string">&quot; stroke-linejoin=&quot;</span>round<span class="hljs-string">&quot; stroke-width=&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot; d=&quot;</span>M5 <span class="hljs-number">5</span>a2 <span class="hljs-number">2</span> 0 012<span class="hljs-number">-2</span>h10a2 <span class="hljs-number">2</span> 0 012 <span class="hljs-number">2</span>v16l<span class="hljs-number">-7</span><span class="hljs-number">-3.5</span>L5 <span class="hljs-number">21</span>V5z<span class="hljs-string">&quot; /&gt;</span><br><span class="hljs-string">          &lt;/svg&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string">      &lt;!-- End Action icons section --&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;!-- Description section --&gt;</span><br><span class="hljs-string">      &lt;button class=&quot;</span>px<span class="hljs-number">-5</span> text-xs text-gray<span class="hljs-number">-500</span> font-bold <span class="hljs-symbol">focus:</span>outline-none<span class="hljs-string">&quot;&gt;&lt;%= @post.total_likes %&gt; likes&lt;/button&gt;</span><br><span class="hljs-string">      &lt;h6 class=&quot;</span>px<span class="hljs-number">-5</span> text-xs text-gray<span class="hljs-number">-400</span><span class="hljs-string">&quot;&gt;&lt;%= Timex.format!(@post.inserted_at, &quot;</span>&#123;Mfull&#125; &#123;D&#125;, &#123;YYYY&#125;<span class="hljs-string">&quot;) %&gt;&lt;/h6&gt;</span><br><span class="hljs-string">      &lt;!-- End Description Section --&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &lt;!-- Comment input section --&gt;</span><br><span class="hljs-string">      &lt;%= if @current_user do %&gt;</span><br><span class="hljs-string">        &lt;%= f = form_for @changeset, &quot;</span><span class="hljs-comment">#&quot;,</span><br>          <span class="hljs-symbol">phx_submit:</span> <span class="hljs-string">&quot;save&quot;</span>,<br>          <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;p-2 flex items-center mt-3 border-t-2 border-gray-100&quot;</span>,<br>          <span class="hljs-symbol">x_data:</span> <span class="hljs-string">&quot;&#123;</span><br><span class="hljs-string">            disableSubmit: true,</span><br><span class="hljs-string">            inputText: null,</span><br><span class="hljs-string">            displayCommentBtn: (refs) =&gt; &#123;</span><br><span class="hljs-string">              refs.cbtn.classList.remove(&#x27;opacity-30&#x27;)</span><br><span class="hljs-string">              refs.cbtn.classList.remove(&#x27;cursor-not-allowed&#x27;)</span><br><span class="hljs-string">            &#125;,</span><br><span class="hljs-string">            disableCommentBtn: (refs) =&gt; &#123;</span><br><span class="hljs-string">              refs.cbtn.classList.add(&#x27;opacity-30&#x27;)</span><br><span class="hljs-string">              refs.cbtn.classList.add(&#x27;cursor-not-allowed&#x27;)</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">          &#125;&quot;</span> %&gt;<br>          &lt;div class=<span class="hljs-string">&quot;w-full&quot;</span>&gt;<br>            &lt;%= textarea f, <span class="hljs-symbol">:body</span>,<br>              <span class="hljs-symbol">class:</span> <span class="hljs-string">&quot;w-full border-0 focus:ring-transparent resize-none&quot;</span>,<br>              <span class="hljs-symbol">rows:</span> <span class="hljs-number">1</span>,<br>              <span class="hljs-symbol">placeholder:</span> <span class="hljs-string">&quot;Add a comment...&quot;</span>,<br>              <span class="hljs-symbol">aria_label:</span> <span class="hljs-string">&quot;Add a comment...&quot;</span>,<br>              <span class="hljs-symbol">autocorrect:</span> <span class="hljs-string">&quot;off&quot;</span>,<br>              <span class="hljs-symbol">autocomplete:</span> <span class="hljs-string">&quot;off&quot;</span>,<br>              <span class="hljs-symbol">x_model:</span> <span class="hljs-string">&quot;inputText&quot;</span>,<br>              <span class="hljs-string">&quot;@input&quot;</span>: <span class="hljs-string">&quot;[</span><br><span class="hljs-string">                (inputText.length != 0) ? [disableSubmit = false, displayCommentBtn($refs)] : [disableSubmit = true, disableCommentBtn($refs)]</span><br><span class="hljs-string">              ]&quot;</span> %&gt;<br>          &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">          &lt;div&gt;</span><br><span class="hljs-regexp">            &lt;%= submit &quot;Post&quot;,</span><br><span class="hljs-regexp">              phx_disable_with: &quot;Posting...&quot;,</span><br><span class="hljs-regexp">              class: &quot;text-light-blue-500 opacity-30 cursor-not-allowed font-bold pb-2 text-sm focus:outline-none&quot;,</span><br><span class="hljs-regexp">              x_ref: &quot;cbtn&quot;,</span><br><span class="hljs-regexp">              &quot;@click&quot;: &quot;inputText = null&quot;,</span><br><span class="hljs-regexp">              &quot;x_bind:disabled&quot;: &quot;disableSubmit&quot; %&gt;</span><br><span class="hljs-regexp">          &lt;/div</span>&gt;<br>        &lt;<span class="hljs-regexp">/form&gt;</span><br><span class="hljs-regexp">      &lt;% else %&gt;</span><br><span class="hljs-regexp">        &lt;div class=&quot;p-4 flex items-center mt-3 border-t-2 border-gray-100&quot;&gt;</span><br><span class="hljs-regexp">          &lt;%= link &quot;Log in to comment&quot;,</span><br><span class="hljs-regexp">            to: Routes.user_session_path(@socket, :new),</span><br><span class="hljs-regexp">            class: &quot;text-light-blue-600&quot; %&gt;</span><br><span class="hljs-regexp">        &lt;/div</span>&gt;<br>      &lt;% <span class="hljs-keyword">end</span> %&gt;<br>      &lt;!-- End Comment input section --&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">  &lt;/div</span>&gt;<br><br>&lt;<span class="hljs-regexp">/section&gt;</span><br></code></pre></td></tr></table></figure>

<p>我们添加了几个 AlpineJS 指令，以在文本区域为空时禁用评论提交按钮。  </p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://s2.loli.net/2023/08/30/9cRfFlpOXx1tC3I.gif" alt="instagram-phoenix-p5-2.gif" class="lazyload"></p>
<p>这部分就是这样，我们在这个系列中学到了很多东西，还有很多工作要做，开发永无止境。</p>
<p>转自：<a target="_blank" rel="noopener" href="https://elixirprogrammer.com/learn/lets-build-an-instagram-clone-with-the-petal-phoenix-elixir-tailwindcss-alpinejs-liveview-stack-part-5/">Elixirprogrammer</a></p>

  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>MarkHoo<br>
        <strong>本文链接：</strong><a href="https://blog.markhoo.com/posts/instagram-phoenix-liveview-p5/" title="https:&#x2F;&#x2F;blog.markhoo.com&#x2F;posts&#x2F;instagram-phoenix-liveview-p5&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.markhoo.com&#x2F;posts&#x2F;instagram-phoenix-liveview-p5&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a> 进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/Elixir/">Elixir</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/AlpineJS/" rel="tag">AlpineJS</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Elixir/" rel="tag">Elixir</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/LiveView/" rel="tag">LiveView</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Phoenix/" rel="tag">Phoenix</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/TailwindCSS/" rel="tag">TailwindCSS</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <div class="valine"></div>
<script src='https://cdn.jsdelivr.net/npm/valine'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'LnljA9jtf29oZKiQMJ6OAWJU-gzGzoHsz',
        appKey: 'wb1Mrzef0b2x540dSrcCcg5y'
    })
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%96%9C%E6%AC%A2"><span class="toc-number">1.</span> <span class="toc-text">喜欢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E8%A1%A8%E8%AF%84%E8%AE%BA"><span class="toc-number">2.</span> <span class="toc-text">发表评论</span></a></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
     
    <div id="nexmoe-search-space">
        <div class="search-container">
            <div class="search-header">
                <div class="search-input-container">
                    <input class="search-input" type="text" placeholder="搜索" oninput="sinput();">
                </div>
                <a class="search-close" onclick="sclose();">×</a>
            </div>
            <div class="search-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1693394534836"></script>



<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





</body>

</html>
